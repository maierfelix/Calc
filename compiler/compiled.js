Math.roundTo=function(a,b){b=1/b;return Math.round(a*b)/b};Array.prototype.sortOn=function(a){if("string"!==typeof a)throw new TypeError(a+" is not a string");if("[object Array]"===Object.prototype.toString.call(this))return this.sort(function(b,c){return b[a]<c[a]?-1:b[a]>c[a]?1:0});throw new TypeError(this+" is not an array");};var root=this,CORE_UI=CORE_UI||{};root.CORE_UI=CORE_UI;CORE_UI.MENU_DIALOG_CONTAINER=document.querySelector("#menu_dialogs");CORE_UI.MENU={};
CORE_UI.MENU.Edit={$:document.querySelector("#menu_edit"),active:!1};CORE_UI.MENU.Modify={$:document.querySelector("#menu_modify"),active:!1};
CORE_UI.init=function(){document.querySelector("#menu_connect").addEventListener("click",function(a){CORE.Connector.loginModal()});CORE.DOM.AddSheet.addEventListener(CORE.Events.mouseDown,function(){this.setAttribute("timestamp",(new Date).getTime())});CORE.DOM.AddSheet.addEventListener(CORE.Events.mouseUp,function(){CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Pressed=!1;var a=parseInt(this.getAttribute("timestamp"));750<=(new Date).getTime()-a?CORE.Sheets.addSheet(!1,!0):CORE.Sheets.addSheet()});
CORE.DOM.RedoButton.addEventListener("click",function(){CORE.Sheets[CORE.CurrentSheet].Commander.redo()});CORE.DOM.UndoButton.addEventListener("click",function(){CORE.Sheets[CORE.CurrentSheet].Commander.undo()});document.querySelector("#import_file").addEventListener("change",function(a){a=a.target;var b=new FileReader;b.onload=function(){if(b.result.substr(11).match("png")){var a=new Image;a.src=b.result;AJAX.POST(a.src,"server/base64ToImage.php",function(b){a=new Image;a.src="server/uploads/"+b;
JS2PNG.Decode(a,function(a){CORE.File["import"](a)})})}else CORE.File["import"](b.result)};b.readAsText(a.files[0])});CORE_UI.initCellStyleMenu()};CORE_UI.closeAllMenus=function(){for(var a=document.querySelector("#menu_dialogs"),b=0;b<a.children.length;++b)a.children[b].style.display="none";for(b in CORE_UI.MENU)CORE_UI.MENU[b].active=!1};CORE_UI.ACTION={save:function(){CORE.File["export"]()},saveImage:function(){CORE.File.exportImage()},open:function(){CORE.File["import"]()}};
CORE_UI.initCellStyleMenu=function(){CORE_UI.initFontChangeMenu();CORE_UI.initBorderChangeMenu();CORE_UI.initBackgroundChangeMenu();CORE_UI.initInjectionButtons()};
CORE_UI.Modal=function(a,b,c){var d=null,e=null;if(a){var f=document.implementation.createHTMLDocument("html");f.documentElement.innerHTML=a;d=f.body}b&&(f=document.implementation.createHTMLDocument("html"),f.documentElement.innerHTML=b,e=f.body);if(e&&e.children.length)for(var g=0;g<e.children.length;++g)"BUTTON"===e.children[g].nodeName&&e.children[g].addEventListener("click",function(a){c(a.target.getAttribute("name"));mui.overlay("off")});a=document.createElement("div");a.className="modal fadeIn";
for(g in e.children)e.children[g]instanceof HTMLElement&&a.appendChild(e.children[g]);mui.overlay("on",a);d=d.children[0];d.className+=" fadeIn";document.querySelector("#mui-overlay").appendChild(d)};
CORE_UI.initBorderChangeMenu=function(){CORE.DOM.ChangeCellBorder.addEventListener("click",function(a){a=CORE.DOM.ChangeCellBorder;a.parentNode&&("true"===a.parentNode.getAttribute("hide")?(CORE.DOM.ChangeCellBorderMenu.style.display="block",a.parentNode.setAttribute("hide","false")):"false"===a.parentNode.getAttribute("hide")&&(CORE.DOM.ChangeCellBorderMenu.style.display="none",a.parentNode.setAttribute("hide","true")));CORE.Sheets[CORE.CurrentSheet].Selector.getSelection()});for(var a=0;a<CORE.DOM.ChangeCellBorderMenuItems.children.length;++a)CORE.DOM.ChangeCellBorderMenuItems.children[a].id&&
CORE.DOM.ChangeCellBorderMenuItems.children[a].addEventListener("click",function(a){var c=null;a.target.id?c=a.target.id:a.target.parentNode.id&&(c=a.target.parentNode.id);CORE.$.validateCells();CORE_UI.updateCellBorder(c);CORE.Sheets[CORE.CurrentSheet].Selector.getSelection()})};
CORE_UI.updateCellBorder=function(a){for(var b=null,c=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected,d=CORE.Sheets[CORE.CurrentSheet].Selector,c=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current&&null!==CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current?c.Columns[c.Current]||c.Rows[c.Current]:null,e=0;e<d.SelectedCells.length;++e){var f=CORE.$.numberToAlpha(d.SelectedCells[e].letter),g=f+d.SelectedCells[e].number,b=CORE.$.getCell({letter:d.SelectedCells[e].letter,
number:d.SelectedCells[e].number});CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.used||(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.used=!0);c&&(c.Border.used=!0);if("border_left"===a){if(c){c.Border.left=c.Border.left?!1:!0;CORE.Sheets[CORE.CurrentSheet].updateWidth("default");d.getSelection();break}CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.left?(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.left=null,0<=b&&(CORE.DOM.Output.children[b].style.borderLeft="")):(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.left=
!0,0<=b&&(CORE.DOM.Output.children[b].style.borderLeft="2px solid black"))}if("border_right"===a){if(c){c.Border.right=c.Border.right?!1:!0;CORE.Sheets[CORE.CurrentSheet].updateWidth("default");d.getSelection();break}CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.right?(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.right=null,0<=b&&(CORE.DOM.Output.children[b].style.borderRight="")):(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.right=!0,0<=b&&(CORE.DOM.Output.children[b].style.borderRight="2px solid black"))}if("border_top"===
a){if(c){c.Border.top=c.Border.top?!1:!0;CORE.Sheets[CORE.CurrentSheet].updateWidth("default");d.getSelection();break}CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.top?(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.top=null,0<=b&&(CORE.DOM.Output.children[b].style.borderTop="")):(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.top=!0,0<=b&&(CORE.DOM.Output.children[b].style.borderTop="2px solid black"))}if("border_bottom"===a){if(c){c.Border.bottom=c.Border.bottom?!1:!0;CORE.Sheets[CORE.CurrentSheet].updateWidth("default");
d.getSelection();break}CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.bottom?(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.bottom=null,0<=b&&(CORE.DOM.Output.children[b].style.borderBottom="")):(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.bottom=!0,0<=b&&(CORE.DOM.Output.children[b].style.borderBottom="2px solid black"))}if("border_all"===a){if(c){c.Border.full?c.Border.full=!1:(c.Border.full=!0,c.Border.left=!1,c.Border.right=!1,c.Border.top=!1,c.Border.bottom=!1);CORE.Sheets[CORE.CurrentSheet].updateWidth("default");
d.getSelection();break}CORE.Cells.Used[f][g].Border.full?(CORE.Cells.Used[f][g].Border.full=!1,0<=b&&(CORE.DOM.Output.children[b].style.border="")):(CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.full=!0,CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.left=!1,CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.right=!1,CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.top=!1,CORE.Cells.Used[CORE.CurrentSheet][f][g].Border.bottom=!1,0<=b&&(CORE.DOM.Output.children[b].style.border="2px solid black"))}if("border_outer"===
a){if(c){c.Border.left=c.Border.left?!1:!0;c.Border.right=c.Border.right?!1:!0;0<=b&&(c.Border.left&&(CORE.DOM.Output.children[b].style.borderLeft="2px solid black"),c.Border.right&&(CORE.DOM.Output.children[b].style.borderRight="2px solid black"));CORE.Sheets[CORE.CurrentSheet].updateWidth("default");d.getSelection();break}d.drawOuterBorder();break}}};
CORE_UI.initFontChangeMenu=function(){var a=document.querySelector("#font_colorpicker"),b=new EightBitColorPicker({el:a});CORE.DOM.ChangeFont.addEventListener("change",function(a){var b=0,e=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected,b=e.Current,f=CORE.Sheets[CORE.CurrentSheet].Selector;CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current&&null!==CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current&&(e=e.Columns[e.Current]||e.Rows[e.Current])&&(e.Font=a.target.value);
CORE.$.validateCells();CORE.Cells.Used[CORE.CurrentSheet][b]&&CORE.Sheets[CORE.CurrentSheet].Selector.inheritMasterStyling(b,e,"Font");for(e=0;e<f.SelectedCells.length;++e){var b=CORE.$.numberToAlpha(f.SelectedCells[e].letter),g=b+f.SelectedCells[e].number;CORE.Cells.Used[CORE.CurrentSheet][b][g]&&(CORE.Cells.Used[CORE.CurrentSheet][b][g].Font=a.target.value,b=CORE.$.getCell({letter:f.SelectedCells[e].letter,number:f.SelectedCells[e].number}),0<=b&&(CORE.DOM.Output.children[b].style.fontFamily=a.target.children[a.target.selectedIndex].getAttribute("value")))}f.getSelection()});
CORE.DOM.ChangeFont.addEventListener("click",function(a){CORE.Sheets[CORE.CurrentSheet].Selector.getSelection()});CORE.DOM.ChangeFontSize.addEventListener("change",function(a){var b=0,e=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected,b=e.Current,f=CORE.Sheets[CORE.CurrentSheet].Selector;f.masterSelected.Current&&null!==f.masterSelected.Current&&(e=e.Columns[e.Current]||e.Rows[e.Current])&&(e.FontSize=~~a.target.value);CORE.$.validateCells();CORE.Cells.Used[CORE.CurrentSheet][b]&&f.inheritMasterStyling(b,
e,"FontSize");for(e=0;e<f.SelectedCells.length;++e)b=CORE.$.numberToAlpha(f.SelectedCells[e].letter),CORE.Cells.Used[CORE.CurrentSheet][b][b+f.SelectedCells[e].number].FontSize=~~a.target.value,b=CORE.$.getCell({letter:f.SelectedCells[e].letter,number:f.SelectedCells[e].number}),0<=b&&(CORE.DOM.Output.children[b].style.fontSize=a.target.children[a.target.selectedIndex].getAttribute("value")+"px");f.getSelection()});CORE.DOM.ChangeFontSize.addEventListener("click",function(a){CORE.Sheets[CORE.CurrentSheet].Selector.getSelection()});
CORE.DOM.ChangeFontBold.addEventListener("click",function(a){CORE.Styler.fontBold()});CORE.DOM.ChangeFontItalic.addEventListener("click",function(a){CORE.Styler.fontItalic()});CORE.DOM.ChangeFontUnderline.addEventListener("click",function(a){CORE.Styler.fontUnderline()});b.addEventListener("colorChange",function(c){a.style.display="block";b.show();CORE.Styler.fontColor(CORE.$.hexToRgba(c.detail.picker.getHexColor()))});CORE.DOM.ChangeFontColor.addEventListener("click",function(c){a.style.display=
"block";b.show()})};CORE_UI.initBackgroundChangeMenu=function(){var a=document.querySelector("#background_colorpicker"),b=new EightBitColorPicker({el:a});b.addEventListener("colorChange",function(a){CORE.Styler.backgroundStyle(CORE.$.hexToRgba(a.detail.picker.getHexColor()))});CORE.DOM.ChangeCellBackground.addEventListener("click",function(c){a.style.display="block";b.show()})};CORE_UI.initLiveCellMenu=function(){};
CORE_UI.initInjectionButtons=function(){CORE.DOM.InsertColumn.addEventListener("click",function(){CORE.Injector.insertColumn()});CORE.DOM.DeleteColumn.addEventListener("click",function(){CORE.Injector.deleteColumn()});CORE.DOM.InsertRow.addEventListener("click",function(){CORE.Injector.insertRow()});CORE.DOM.DeleteRow.addEventListener("click",function(){CORE.Injector.deleteRow()})};
CORE_UI.updateCellStyleMenu=function(a){var b=CORE.$.numberToAlpha(a.letter);a=a.number;var c=b+a,d=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns,e=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows;CORE.DOM.CellInput.value=CORE.Cells.Used[CORE.CurrentSheet][b]&&CORE.Cells.Used[CORE.CurrentSheet][b][c]?CORE.Cells.Used[CORE.CurrentSheet][b][c].Formula?CORE.Cells.Used[CORE.CurrentSheet][b][c].Formula:void 0!==CORE.Cells.Used[CORE.CurrentSheet][b][c].Content&&null!==CORE.Cells.Used[CORE.CurrentSheet][b][c].Content?
CORE.Cells.Used[CORE.CurrentSheet][b][c].Content:"":"";CORE.Cells.Used[CORE.CurrentSheet][b]&&CORE.Cells.Used[CORE.CurrentSheet][b][c]?(CORE.DOM.ChangeFont.value=CORE.Cells.Used[CORE.CurrentSheet][b][c].Font?CORE.Cells.Used[CORE.CurrentSheet][b][c].Font:"Arial",CORE.DOM.ChangeFontSize.value=CORE.Cells.Used[CORE.CurrentSheet][b][c].FontSize?CORE.Cells.Used[CORE.CurrentSheet][b][c].FontSize:12,CORE.DOM.ChangeFontColor.style.background=CORE.Cells.Used[CORE.CurrentSheet][b][c].Color?CORE.Cells.Used[CORE.CurrentSheet][b][c].Color:
"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontBold.style.background=CORE.Cells.Used[CORE.CurrentSheet][b][c].FontBold?"rgba(68, 138, 255, 0.75)":"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontItalic.style.background=CORE.Cells.Used[CORE.CurrentSheet][b][c].FontItalic?"rgba(68, 138, 255, 0.75)":"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontUnderline.style.background=CORE.Cells.Used[CORE.CurrentSheet][b][c].FontUnderlined?"rgba(68, 138, 255, 0.75)":"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeCellBackground.style.background=
CORE.Cells.Used[CORE.CurrentSheet][b][c].BackgroundColor?CORE.Cells.Used[CORE.CurrentSheet][b][c].BackgroundColor:"rgba(50, 50, 50, 0.70)"):d[b]?(CORE.DOM.ChangeCellBackground.style.background=d[b].BackgroundColor?d[b].BackgroundColor:"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFont.value=d[b].Font?d[b].Font:"Arial",d[b].FontSize?CORE.DOM.ChangeFont.value=d[b].FontSize:CORE.DOM.ChangeFontSize.value=12,CORE.DOM.ChangeFontColor.style.background=d[b].Color?d[b].Color:"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontBold.style.background=
d[b].FontBold?"rgba(68, 138, 255, 0.75)":"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontBold.style.background=d[b].FontItalic?"rgba(68, 138, 255, 0.75)":"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontBold.style.background=d[b].FontUnderlined?"rgba(68, 138, 255, 0.75)":"rgba(50, 50, 50, 0.70)"):e[a]?(CORE.DOM.ChangeCellBackground.style.background=e[a].BackgroundColor?e[a].BackgroundColor:"rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFont.value=e[a].Font?e[a].Font:CORE.DOM.ChangeFont.children[0].getAttribute("value"),
e[a].FontSize?CORE.DOM.ChangeFont.value=e[a].FontSize:CORE.DOM.ChangeFontSize.value=CORE.DOM.ChangeFontSize.children[6].getAttribute("value"),e[a].Color?CORE.DOM.ChangeFont.value=e[a].Color:CORE.DOM.ChangeFontColorPreview.style.color="#c7c7c7",e[a].FontBold?(CORE.DOM.ChangeFontBoldPreview.parentNode.style.background="rgba(68, 138, 255, 0.75)",CORE.DOM.ChangeFontBoldPreview.style.color="#7d7d7d"):(CORE.DOM.ChangeFontBoldPreview.parentNode.style.background="#fff",CORE.DOM.ChangeFontBoldPreview.style.color=
"#c7c7c7"),e[a].FontItalic?(CORE.DOM.ChangeFontBoldPreview.parentNode.style.background="rgba(68, 138, 255, 0.75)",CORE.DOM.ChangeFontBoldPreview.style.color="#7d7d7d"):(CORE.DOM.ChangeFontBoldPreview.parentNode.style.background="#fff",CORE.DOM.ChangeFontBoldPreview.style.color="#c7c7c7"),e[a].FontUnderlined?(CORE.DOM.ChangeFontBoldPreview.parentNode.style.background="rgba(68, 138, 255, 0.75)",CORE.DOM.ChangeFontBoldPreview.style.color="#7d7d7d"):(CORE.DOM.ChangeFontBoldPreview.parentNode.style.background=
"#fff",CORE.DOM.ChangeFontBoldPreview.style.color="#c7c7c7")):(CORE.DOM.CellInput.textContent="",CORE.DOM.ChangeFont.value="Arial",CORE.DOM.ChangeFontSize.value=12,CORE.DOM.ChangeFontColor.style.background="rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontBold.style.background="rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontItalic.style.background="rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeFontUnderline.style.background="rgba(50, 50, 50, 0.70)",CORE.DOM.ChangeCellBackground.style.background="rgba(50, 50, 50, 0.70)")};
var root=this,CORE=CORE||{};CORE.VERSION="0.3";CORE.DOM={};CORE.Settings={Width:window.innerWidth,Height:window.innerHeight};CORE.Cells={Used:{},Live:{}};CORE.SystemSpeed=1;CORE.Language="en";CORE.CurrentSheet="Sheet1";CORE.SheetCount=0;CORE.MasterSheetCount=0;CORE.Settings.Mobile=!1;CORE.Settings.isIOS=!1;CORE.Settings.isAndroid=!1;CORE.Settings.isFirefox=!1;CORE.Settings.isChrome=!1;CORE.Settings.isSafari=!1;CORE.Settings.isIE=!1;
CORE.Settings.Scroll={Vertical:1,OriginalVertical:1,Horizontal:1,OriginalHorizontal:1};CORE.Events={};CORE.REGEX={numbers:/[^0-9]/g,letters:/[^a-zA-Z]/g,variable:/[a-zA-Z_][a-zA-Z0-9_]+/g,strings:/[a-zA-Z_!@#$%^&*()+\-=\[\]{};':"\\|,.<>\s]+/g};root.CORE=CORE;CORE.DOM.Cache={};CORE.DOM.FileOutput=document.querySelector("#file");CORE.DOM.MainContainer=document.querySelector("#container");CORE.DOM.Output=document.querySelector("#output");CORE.DOM.VerticalMenu=document.querySelector("#number_menu");
CORE.DOM.HorizontalMenu=document.querySelector("#letter_menu");CORE.DOM.CurrentCell=document.querySelector("#current_cell");CORE.DOM.DebugContainer=document.querySelector("#debug");CORE.DOM.ChangeFont=document.querySelector("#change_font");CORE.DOM.ChangeFontSize=document.querySelector("#change_fontSize");CORE.DOM.ChangeFontColor=document.querySelector("#change_fontColor");CORE.DOM.ChangeFontBold=document.querySelector("#change_bold");CORE.DOM.ChangeFontItalic=document.querySelector("#change_italic");
CORE.DOM.ChangeFontUnderline=document.querySelector("#change_underline");CORE.DOM.ChangeLiveCell=document.querySelector("#change_livecell");CORE.DOM.LiveCellOutput=document.querySelector("#livecell_current");CORE.DOM.LiveCellContainer=document.querySelector("#livecell_current_container");CORE.DOM.ChangeCellBorder=document.querySelector("#change_border");CORE.DOM.ChangeCellBorderMenu=document.querySelector("#border_settings_menu");CORE.DOM.ChangeCellBorderMenuItems=document.querySelector("#border_settings_menu_items");
CORE.DOM.ChangeCellBackground=document.querySelector("#change_background");CORE.DOM.InsertColumn=document.querySelector("#insert_column");CORE.DOM.DeleteColumn=document.querySelector("#delete_column");CORE.DOM.InsertRow=document.querySelector("#insert_row");CORE.DOM.DeleteRow=document.querySelector("#delete_row");CORE.DOM.AddSheet=document.querySelector("#add_sheet");CORE.DOM.Sheets=document.querySelector("#current_sheets");CORE.DOM.RedoButton=document.querySelector("#button_redo");
CORE.DOM.UndoButton=document.querySelector("#button_undo");CORE.DOM.CellInput=document.querySelector("#cell_input");
CORE.eval=function(a){var b=null,c=null;a?(b=CORE.Cells.Used[a],c=CORE.Cells.Used[a]):(b=CORE.Cells.Used[CORE.CurrentSheet],c=CORE.Cells.Used[CORE.CurrentSheet]);a=[];var d=0,e;for(e in b)for(var f in b[e])b[e][f].Formula&&b[e][f].Formula.length&&a.push({name:f,value:b[e][f].Formula.substr(0,0)+f+b[e][f].Formula.substr(0),variableReferences:CORE.$.getVariables(b[e][f].Formula.substr(0))});if(a&&a.length)for(e=0;e<a.length;++e)b=a[e].name.match(CORE.REGEX.numbers).join(""),d=ENGEL.interpret(a[e].value).VAR[a[e].name].value.value,
c[b][a[e].name].Content=d,f=a[e].name,b=CORE.$.alphaToNumber(f.match(CORE.REGEX.numbers).join("")),f=~~f.match(CORE.REGEX.letters).join(""),b=CORE.$.getCell({letter:b,number:f}),0<=b&&(CORE.DOM.Output.children[b].innerHTML=d)};CORE.registerCellVariable=function(a){if(!ENGEL.STACK.get(a))if(ENGEL.STACK.createVariable(a),ENGEL.STACK.VAR[a])ENGEL.STACK.VAR[a].name=a;else throw Error("Fatal Error, failed to register "+a+"!");};CORE.validCell=function(a){return ENGEL.STACK.get(a)?!0:!1};
CORE.updateCell=function(a,b){ENGEL.STACK.get(a)&&ENGEL.STACK.update(a,{raw:b,value:ENGEL.TypeMaster(b).value,type:"number"})};CORE.registerCell=function(a){var b=a.match(CORE.REGEX.numbers).join(""),c=a.match(CORE.REGEX.letters).join("");CORE.$.registerCell({letter:b,number:c});CORE.registerCellVariable(a)};CORE.registerLiveCell=function(a){CORE.Cells.Live[a]=new CORE.Sheets[CORE.CurrentSheet].LiveCell};CORE.Event={};
CORE.Event.init=function(){CORE.Settings.Mobile?(window.addEventListener("resize",CORE.Event.resize,!1),window.addEventListener("touchstart",CORE.Event.mouseDown,!1),window.addEventListener("touchend",CORE.Event.mouseUp,!1),window.addEventListener("touchcancel",CORE.Event.mouseUp,!1),window.addEventListener("touchmove",CORE.Event.scroll,!1),window.addEventListener("keydown",CORE.Event.keyPress,!1)):(window.addEventListener("resize",CORE.Event.resize,!1),window.addEventListener("mousedown",CORE.Event.mouseDown,
!1),window.addEventListener("mouseup",CORE.Event.mouseUp,!1),window.addEventListener("mousemove",CORE.Event.mouseWipe,!1),window.addEventListener("mousewheel",CORE.Event.scroll,!1),window.addEventListener("DOMMouseScroll",CORE.Event.scroll,!1),window.addEventListener("keydown",CORE.Event.keyPress,!1),window.addEventListener("keyup",CORE.Event.keyUp,!1))};
CORE.Event.resize=function(){CORE.Settings.Width=window.innerWidth;CORE.Settings.Height=window.innerHeight;CORE.Settings.Scroll.OriginalVertical=CORE.Settings.Scroll.Vertical=CORE.$.calculateScrollAmount();CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY=!1;CORE.Sheets[CORE.CurrentSheet].calculateGrid();CORE.Sheets[CORE.CurrentSheet].generateCells();CORE.Sheets[CORE.CurrentSheet].updateWidth("default");CORE.Sheets[CORE.CurrentSheet].Selector.getSelection();CORE.Awakener.reset();CORE.Awakener.evalLive();
CORE.eval();CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Strg=!1};CORE.Event.redraw=function(a){a=a||CORE.CurrentSheet;CORE.Sheets[a].Settings.redrawOnZero=!1;CORE.Sheets[a].Input.lastAction.scrollY=!1;CORE.Sheets[a].calculateGrid();CORE.Sheets[a].generateCells();CORE.Sheets[a].updateWidth("default");CORE.Sheets[a].Selector.getSelection()};
CORE.Event.animateMouseUp=function(){CORE.DOM.Output.classList.remove("moveDown");CORE.DOM.VerticalMenu.classList.remove("moveDown");CORE.DOM.Output.classList.remove("moveUp");CORE.DOM.VerticalMenu.classList.remove("moveUp");setTimeout(function(){CORE.DOM.Output.classList.add("moveDown");CORE.DOM.VerticalMenu.classList.add("moveDown");CORE.DOM.Output.style.top="-25px";CORE.DOM.VerticalMenu.style.top="-25px"},1)};
CORE.Event.animateMouseUpMaximum=function(){CORE.DOM.Output.classList.remove("moveDown");CORE.DOM.VerticalMenu.classList.remove("moveDown");CORE.DOM.Output.classList.remove("moveUp");CORE.DOM.VerticalMenu.classList.remove("moveUp");CORE.DOM.Output.style.top="0px";CORE.DOM.VerticalMenu.style.top="0px"};
CORE.Event.animateMouseDown=function(){CORE.DOM.Output.classList.remove("moveDown");CORE.DOM.VerticalMenu.classList.remove("moveDown");CORE.DOM.Output.classList.remove("moveUp");CORE.DOM.VerticalMenu.classList.remove("moveUp");setTimeout(function(){CORE.DOM.Output.classList.add("moveUp");CORE.DOM.VerticalMenu.classList.add("moveUp")},55)};
CORE.Event.mouseDoubleClick=function(a){a.target.parentNode.id===CORE.DOM.Output.id&&(a=a.target.getAttribute("name"),CORE.Sheets[CORE.CurrentSheet].cleanEditSelection(),CORE.Sheets[CORE.CurrentSheet].Selector.cellFocusSwitch=!1,CORE.Sheets[CORE.CurrentSheet].getEditSelection(a))};
CORE.Event.mouseDown=function(a){if(1===a.button||2===a.button||3===a.which||2===a.which||CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Pressed)a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Selector.getSelection();else{CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDown||(CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDown=a.timeStamp);if(0<CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDown){var b=a.timeStamp-CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDown;if(b&&250>=b&&
a.target.parentNode.id===CORE.DOM.Output.id&&a.target.getAttribute("name")===CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDownCell){CORE.Event.mouseDoubleClick(a);return}}if("cell_input"===a.target.id)CORE.Sheets[CORE.CurrentSheet].Selector.Select.Letter&&CORE.Sheets[CORE.CurrentSheet].Selector.Select.Number&&(CORE.eval(),CORE.Sheets[CORE.CurrentSheet].cleanEditSelection(),CORE.Sheets[CORE.CurrentSheet].getEditSelection(CORE.Sheets[CORE.CurrentSheet].Selector.Select)),CORE.Sheets[CORE.CurrentSheet].Selector.getSelection();
else if(a.target.parentNode.id!==CORE.DOM.VerticalMenu.id&&a.target.parentNode.id!==CORE.DOM.HorizontalMenu.id){if(a.target.parentNode.id===CORE.DOM.Output.id){CORE.Sheets[CORE.CurrentSheet].Selector.allSelected&&(CORE.Sheets[CORE.CurrentSheet].Selector.deleteCellHoverEffect(),CORE.Sheets[CORE.CurrentSheet].Selector.allSelected=!1,CORE.Sheets[CORE.CurrentSheet].Selector.getSelection());CORE.Sheets[CORE.CurrentSheet].Input.Mouse.LiveCellEdit=!1;CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=
null;CORE.DOM.LiveCellContainer.style.display="none";CORE.Sheets[CORE.CurrentSheet].Input.Mouse.startedMouseWipe=!0;var c=a.target.getAttribute("name"),b=CORE.$.alphaToNumber(c.match(CORE.REGEX.numbers).join("")),c=~~c.match(CORE.REGEX.letters).join(""),d=CORE.$.numberToAlpha(b)+c;CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDownCell.Letter=b;CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDownCell.Number=c;CORE.Sheets[CORE.CurrentSheet].Selector.Select=CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDownCell;
CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First={Letter:b,Number:c};CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last=CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First;CORE.Sheets[CORE.CurrentSheet].Selector.parentSelectedCell=CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First;CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX=CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY=0;CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter&&CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number&&
CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last.Letter&&CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last.Number&&CORE.Sheets[CORE.CurrentSheet].Selector.getSelection();if(CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit&&CORE.Sheets[CORE.CurrentSheet].Selector.Edit!==CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First||CORE.Sheets[CORE.CurrentSheet].Selector.Edit!==CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last&&CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First===CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last)CORE.eval(),
CORE.Sheets[CORE.CurrentSheet].cleanEditSelection();CORE.Cells.Used[CORE.CurrentSheet][CORE.$.numberToAlpha(b)]&&(CORE.Cells.Used[CORE.CurrentSheet][CORE.$.numberToAlpha(b)][d]||CORE.Sheets[CORE.CurrentSheet].cleanEditSelection())}else CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit&&(a.target.parentNode.id===CORE.DOM.Output.id?CORE.Sheets[CORE.CurrentSheet].cleanEditSelection():(CORE.Sheets[CORE.CurrentSheet].Selector.getSelection(),CORE.Sheets[CORE.CurrentSheet].getEditSelection(CORE.Sheets[CORE.CurrentSheet].Selector.Edit)));
CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDown=a.timeStamp;CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Pressed=!0}}};
CORE.Event.mouseUp=function(a){var b=CORE.Sheets[CORE.CurrentSheet];b.Input.Mouse.Pressed=!1;b.Input.Mouse.Extend&&(b.Input.Mouse.Extend=!1,CORE.Extender.extend(),b.updateWidth("default"),b.Selector.getSelection());CORE.Sheets[CORE.CurrentSheet].Input.Mouse.CellResize&&(b.updateWidth(),b.generateMenu(),b.Selector.getSelection(),b.Input.Mouse.CellResize=!1);a.target.parentNode&&a.target.parentNode.id===CORE.DOM.Output.id&&b.Selector.Selected.First.Letter&&b.Selector.Selected.First.Number&&b.Selector.Selected.Last.Letter&&
b.Selector.Selected.Last.Number&&(a=CORE.newCommand(),a.caller="Selector",a.action="select",a.data={first:b.Selector.Selected.First,last:b.Selector.Selected.Last},b.Commander.pushUndoCommand(a))};
CORE.Event.mouseWipe=function(a){var b=CORE.Sheets[CORE.CurrentSheet];if(CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMousePosition.x!==a.pageX||CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMousePosition.y!==a.pageY){CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Pressed&&(b.mouseMoveDirection.directionX=a.pageX<b.mouseMoveDirection.oldX?"left":a.pageX>b.mouseMoveDirection.oldX?"right":null,b.mouseMoveDirection.directionY=a.pageY<b.mouseMoveDirection.oldY?"up":a.pageY>b.mouseMoveDirection.oldY?"down":
null,b.mouseMoveDirection.oldY=a.pageY,b.mouseMoveDirection.oldX=a.pageX);if(CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Pressed&&a.target.parentNode&&a.target.parentNode.id===CORE.DOM.Output.id){var c=a.target.getAttribute("name"),b=CORE.$.alphaToNumber(c.match(CORE.REGEX.numbers).join("")),c=~~c.match(CORE.REGEX.letters).join(""),d=CORE.$.numberToAlpha(b)+c,e=CORE.$.numberToAlpha(b);if(CORE.$.numberToAlpha(CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last.Letter)+CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last.Number===
d)return;CORE.Sheets[CORE.CurrentSheet].Input.Mouse.startedMouseWipe&&(CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First={Letter:CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDownCell.Letter,Number:CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseDownCell.Number});CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last={Letter:b,Number:c};CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter&&CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number&&CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last.Letter&&
CORE.Sheets[CORE.CurrentSheet].Selector.Selected.Last.Number&&(CORE.Cells.Used[CORE.CurrentSheet][e]&&!CORE.Cells.Used[CORE.CurrentSheet][e][e+c]&&CORE.Cells.Used[CORE.CurrentSheet][e][d]&&CORE.Sheets[CORE.CurrentSheet].cleanEditSelection(),CORE.Sheets[CORE.CurrentSheet].Selector.getSelection());CORE.Cells.Used[CORE.CurrentSheet][CORE.$.numberToAlpha(b)]&&CORE.Cells.Used[CORE.CurrentSheet][CORE.$.numberToAlpha(b)][d]&&CORE.Sheets[CORE.CurrentSheet].cleanEditSelection()}CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMousePosition.x=
a.pageX;CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMousePosition.y=a.pageY;CORE.Sheets[CORE.CurrentSheet].Input.Mouse.startedMouseWipe=!0}};
CORE.Event.scroll=function(a){var b=0;if(CORE.Settings.Mobile){var c=a.touches[0].clientY,d=a.touches[0].clientX,e=CORE.Sheets[CORE.CurrentSheet].Input.Touch.lastY;c>e?b=0:c<e&&(b=1);CORE.Sheets[CORE.CurrentSheet].Input.Touch.lastY=c;CORE.Sheets[CORE.CurrentSheet].Input.Touch.lastX=d}CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseScroll||(CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseScroll=a.timeStamp);if(!CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Strg&&(c=Math.floor(CORE.Sheets[CORE.CurrentSheet].Settings.y*
(CORE.SystemSpeed-.5)),d=0,a.target.parentNode.id===CORE.DOM.Output.id)){CORE.Settings.Mobile||(a.wheelDelta?(0<-120*a.wheelDelta&&(b=1),d=Math.floor(a.wheelDelta/10),d=0>=d?-1*d:d):0<a.deltaY?(b=1,d=Math.floor(a.deltaY),d=0>=d?-1*d:d):0<-120*a.detail?(b=0,d=Math.floor(10*a.detail),d=0>=d?-1*d:d):0>-120*a.detail?(b=1,d=Math.floor(10*a.detail),d=0>=d?-1*d:d):b=0);b=b?"down":"up";if(0<CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseScroll){var f=a.timeStamp-CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseScroll,
e=CORE.Sheets[CORE.CurrentSheet].Selector.SelectedCells.length;CORE.Settings.Mobile?CORE.Settings.Scroll.Vertical=CORE.Settings.Scroll.OriginalVertical+2:1E3<=CORE.Sheets[CORE.CurrentSheet].Selector.SelectedCells.length?CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Pressed?CORE.Settings.Scroll.Vertical=c+100*Math.ceil(Math.log(e+1)/Math.LN10):f/CORE.SystemSpeed<=c*Math.ceil(Math.log(e+1)/Math.LN10)/CORE.SystemSpeed?CORE.Settings.Scroll.Vertical=Math.floor(d):CORE.Settings.Scroll.Vertical=75>=f&&1E4<=
e?Math.floor(d):CORE.Settings.Scroll.OriginalVertical:CORE.Settings.Scroll.Vertical=75>=f?Math.floor(d):CORE.Settings.Scroll.OriginalVertical}CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY=!0;"down"===b?(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY+=CORE.Settings.Scroll.Vertical,CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=CORE.Settings.Scroll.Vertical,(75<f||f>2*c)&&CORE.Event.animateMouseDown(),CORE.Sheets[CORE.CurrentSheet].updateHeight("down",CORE.Settings.Scroll.Vertical)):
"up"===b&&(0>=CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY-CORE.Settings.Scroll.Vertical?(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY=0,CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=0,CORE.Sheets[CORE.CurrentSheet].updateHeight("default",CORE.Settings.Scroll.Vertical),CORE.Event.animateMouseUpMaximum(),CORE.Sheets[CORE.CurrentSheet].Settings.cellResizedX+CORE.Sheets[CORE.CurrentSheet].Settings.cellResizedY&&CORE.Sheets[CORE.CurrentSheet].Settings.redrawOnZero&&CORE.Event.redraw()):
0<=CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY-CORE.Settings.Scroll.Vertical&&(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY-=CORE.Settings.Scroll.Vertical,CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=CORE.Settings.Scroll.Vertical,CORE.Sheets[CORE.CurrentSheet].updateHeight("up",CORE.Settings.Scroll.Vertical),(75<f||f>2*c)&&CORE.Event.animateMouseUp()));b&&(CORE.Connector.connected&&CORE.Connector.action("scrolling",{direction:b,amount:CORE.Settings.Scroll.Vertical,position:CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY}),
CORE.Sheets[CORE.CurrentSheet].updateMenu(),CORE.Sheets[CORE.CurrentSheet].Selector.getSelection(),CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMousePosition.x=Math.random(),CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMousePosition.y=Math.random(),CORE.Settings.Mobile||CORE.Event.mouseWipe(a));CORE.Sheets[CORE.CurrentSheet].Input.Mouse.lastMouseScroll=a.timeStamp}};
CORE.Event.keyPress=function(a){CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress||(CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress=a.timeStamp);if(0<CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress){var b=a.timeStamp-CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress;if(b&&100>=b)return}if(46===a.keyCode)a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Selector.deleteCellSelection();else if(67===a.keyCode&&CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Strg&&!CORE.Event.inEditMode())a.preventDefault(),
CORE.ClipBoard.copyCellsToClipBoard();else if(86===a.keyCode&&CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Strg&&!CORE.Event.inEditMode())a.preventDefault(),CORE.ClipBoard.pasteCellsIntoSheet(CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First);else if(88===a.keyCode&&CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Strg&&!CORE.Event.inEditMode())a.preventDefault(),CORE.ClipBoard.copyCellsToClipBoard(),CORE.Sheets[CORE.CurrentSheet].Selector.deleteCellSelection();else if(65===a.keyCode&&CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Strg&&
!CORE.Event.inEditMode())a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Selector.allSelected=!0,CORE.Sheets[CORE.CurrentSheet].Selector.getSelection();else if(!CORE.Sheets[CORE.CurrentSheet].Input.Mouse.LiveCellEdit&&123!==a.keyCode)if(13===a.keyCode&&(a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null,CORE.Event.pressedEnter(a.keyCode)),16===a.keyCode)a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Shift=!0;else if(17===a.keyCode)a.preventDefault(),
CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Strg=!0;else if(9===a.keyCode)a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Tab=!0,CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null,CORE.Event.navigateTo("right",1);else if(33===a.keyCode)a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null,CORE.Sheets[CORE.CurrentSheet].Selector.jump("up",CORE.Sheets[CORE.CurrentSheet].Settings.y);else if(34===a.keyCode)a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=
null,CORE.Sheets[CORE.CurrentSheet].Selector.jump("down",CORE.Sheets[CORE.CurrentSheet].Settings.y);else{CORE.Event.pressedArrowKey(a.keyCode)&&CORE.Sheets[CORE.CurrentSheet].Selector.allSelected&&(CORE.Sheets[CORE.CurrentSheet].Selector.deleteCellHoverEffect(),CORE.Sheets[CORE.CurrentSheet].Selector.allSelected=!1,CORE.Sheets[CORE.CurrentSheet].Selector.getSelection());switch(a.keyCode){case 38:if(CORE.Event.inEditMode())return;--CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY;CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=
1;CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null;CORE.Sheets[CORE.CurrentSheet].Selector.selectCellByKeyPress();CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress=a.timeStamp-100;return;case 40:if(CORE.Event.inEditMode())return;CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+=1;CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=1;CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null;CORE.Sheets[CORE.CurrentSheet].Selector.selectCellByKeyPress();CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress=
a.timeStamp-100;return;case 37:if(CORE.Event.inEditMode())return;CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX-=CORE.Settings.Scroll.Horizontal;CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollX=CORE.Settings.Scroll.Horizontal;CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null;CORE.Sheets[CORE.CurrentSheet].Selector.selectCellByKeyPress();CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress=a.timeStamp-100;CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY=!1;return;case 39:if(CORE.Event.inEditMode())return;
CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX+=CORE.Settings.Scroll.Horizontal;CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollX=CORE.Settings.Scroll.Horizontal;CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Current=null;CORE.Sheets[CORE.CurrentSheet].Selector.selectCellByKeyPress();CORE.Sheets[CORE.CurrentSheet].Input.lastKeyPress=a.timeStamp-100;CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY=!1;return}CORE.Event.sniffCellInput(a.keyCode)}};
CORE.Event.keyUp=function(a){16===a.keyCode&&(a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Shift=!1);17===a.keyCode&&(a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Strg=!1);9===a.keyCode&&(a.preventDefault(),CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Tab=!1)};
CORE.Event.inEditMode=function(){if(CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit&&CORE.Sheets[CORE.CurrentSheet].Selector.Edit){var a=CORE.Sheets[CORE.CurrentSheet].Selector.Edit.match(CORE.REGEX.numbers).join("");if(CORE.Cells.Used[CORE.CurrentSheet][a]&&CORE.Cells.Used[CORE.CurrentSheet][a][CORE.Sheets[CORE.CurrentSheet].Selector.Edit])return!0}return!1};CORE.Event.pressedArrowKey=function(a){return 0<=[37,38,39,40].indexOf(a)?!0:!1};
CORE.Event.pressedEnter=function(a){return 13===a?(CORE.Event.inEditMode()&&(CORE.Sheets[CORE.CurrentSheet].cleanEditSelection(),CORE.Sheets[CORE.CurrentSheet].Selector.getSelection()),!0):!1};
CORE.Event.sniffCellInput=function(a){var b=0;if(CORE.Event.inEditMode()){CORE.Sheets[CORE.CurrentSheet].Selector.cellFocusSwitch=!1;var c=CORE.$.alphaToNumber(CORE.Sheets[CORE.CurrentSheet].Selector.Edit.match(CORE.REGEX.numbers).join("")),b=~~CORE.Sheets[CORE.CurrentSheet].Selector.Edit.match(CORE.REGEX.letters).join(""),b=CORE.$.getCell({letter:c,number:b});0<=b&&(CORE.Cells.Used[CORE.CurrentSheet][CORE.$.numberToAlpha(c)][CORE.Sheets[CORE.CurrentSheet].Selector.Edit].Content=CORE.DOM.CellInput.value)}CORE.Event.pressedEnter(a)?
CORE.Event.navigateTo("down",1):(CORE.Sheets[CORE.CurrentSheet].cleanEditSelection(),CORE.Sheets[CORE.CurrentSheet].getEditSelection({letter:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter,number:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number}),this.processCellContent())};
CORE.Event.isFormula=function(){var a=CORE.Sheets[CORE.CurrentSheet].Selector.Edit;if(CORE.Event.inEditMode()){var b=a.match(CORE.REGEX.numbers).join(""),c=a.match(CORE.REGEX.letters).join(""),d=CORE.Cells.Used[CORE.CurrentSheet][b]&&CORE.Cells.Used[CORE.CurrentSheet][b][a].Content?CORE.Cells.Used[CORE.CurrentSheet][b][a].Content:void 0;void 0!==d&&null!==d&&d.length&&("="===d[0]?(CORE.Cells.Used[CORE.CurrentSheet][b][a].Formula=d,CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&CORE.Styler.inheritCellValue({letter:b,
number:c,value:CORE.DOM.CellInput.value,type:"Formula"})):(CORE.Cells.Used[CORE.CurrentSheet][b][a].Formula&&CORE.Cells.Used[CORE.CurrentSheet][b][a].Formula.length&&(CORE.Cells.Used[CORE.CurrentSheet][b][a].Formula=null),CORE.Cells.Used[CORE.CurrentSheet][b][a].Content&&CORE.Cells.Used[CORE.CurrentSheet][b][a].Content.length&&CORE.updateCell(a,CORE.Cells.Used[CORE.CurrentSheet][b][a].Content),CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&CORE.Styler.inheritCellValue({letter:b,number:c,value:CORE.DOM.CellInput.value,
type:"Content"})))}};
CORE.Event.processCellContent=function(){var a=CORE.Sheets[CORE.CurrentSheet].Selector.Edit,b=null,c=0,d=a.match(CORE.REGEX.numbers).join(""),e=a.match(CORE.REGEX.letters).join("");CORE.DOM.CellInput.focus();setTimeout(function(){CORE.$.registerCell({letter:d,number:e});c=CORE.$.getCell({letter:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter,number:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number});0<=c&&(b=CORE.DOM.Output.children[c]);CORE.Cells.Used[CORE.CurrentSheet][d][a]?CORE.Cells.Used[CORE.CurrentSheet][d][a].Content=
CORE.DOM.CellInput.value:CORE.registerCell(a);b&&(b.innerHTML=CORE.Cells.Used[CORE.CurrentSheet][d][a].Content);CORE.Event.isFormula();CORE.Cells.Used[CORE.CurrentSheet][d][a]&&CORE.Cells.Used[CORE.CurrentSheet][d][a].Content&&CORE.Sheets[CORE.CurrentSheet].Selector.cellFocusSwitch&&CORE.Sheets[CORE.CurrentSheet].goToEndOfCellText();CORE.Sheets[CORE.CurrentSheet].Selector.cellFocusSwitch=!0;CORE.DOM.CellInput.focus();CORE.Connector.connected&&CORE.Connector.action("updateCell",{cell:a,value:CORE.DOM.CellInput.value})},
1)};CORE.Event.navigateTo=function(a,b){CORE.eval();CORE.Sheets[CORE.CurrentSheet].getEditSelection({letter:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter,number:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number});CORE.Sheets[CORE.CurrentSheet].cleanEditSelection();CORE.Sheets[CORE.CurrentSheet].Selector.moveSelection(a,b);CORE.DOM.CellInput.blur()};CORE.Speedy=function(){};CORE.Speedy.prototype=CORE.Speedy;CORE.Speedy.prototype.constructor=CORE.Speedy;
CORE.Speedy.prototype.runTest=function(a){if(!CORE.Settings.Mobile)if(localStorage.SystemSpeed)CORE.SystemSpeed=~~localStorage.SystemSpeed;else{for(var b=null,b=performance.now(),c=CORE.Sheets[CORE.CurrentSheet].Selector.SelectedCells,d=0;1E4>d;++d)c.push({letter:1,number:d});for(c=1;50>=c;++c)CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY=c,CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=c,CORE.Sheets[CORE.CurrentSheet].updateHeight("down",1),CORE.Sheets[CORE.CurrentSheet].updateMenu(),CORE.Sheets[CORE.CurrentSheet].Selector.getSelection();
b=performance.now()-b;b=200>b?1:400>b?1:500>b?2:500<b?2:600<b?3:700<b?4:5;localStorage.setItem("SystemSpeed",b);CORE.SystemSpeed=b}a(1)};CORE.Sheets=function(){};CORE.Sheets.prototype=CORE.Sheets;CORE.Sheets.prototype.constructor=CORE.Sheets;
CORE.Sheets.prototype.addSheet=function(a,b){CORE.SheetCount++;var c=CORE.SheetCount,d=b||!1;if(d&&1<CORE.MasterSheetCount+1)CORE_UI.Modal("<h3 class='modalTitle'>More than one master sheet isn't allowed!</h3>","<button class='mui-btn mui-btn-primary mui-btn-lg alertButton alertOk' name='ok'>Ok</button>",function(a){});else{if(Object.keys(CORE.Sheets).length){if(CORE.Sheets["Sheet"+c])for(;c++&&(CORE.Sheets["Sheet"+c]||!(c>CORE.SheetCount)););}else c=1;a&&a.length?CORE.CurrentSheet=a:d?(CORE.MasterSheetCount++,
CORE.CurrentSheet="MasterSheet"+c):CORE.CurrentSheet="Sheet"+c;CORE.$.createSheet(CORE.CurrentSheet,d);c=document.createElement("button");c.className="mui-btn mui-btn-default mui-btn-mini slideUp";d?c.setAttribute("style","color:#fff;background-color:rgba(129, 199, 132, 0.8);"):c.setAttribute("style","color:#fff;background-color:rgba(130, 177, 255, 0.8);");c.setAttribute("name",CORE.CurrentSheet);c.innerHTML=CORE.CurrentSheet;var e=document.createElement("button");e.innerHTML="-";e.className="closeButton";
var f=document.createElement("p");f.className="usersInRoom";var g=document.createElement("p");g.className="sheetType";g.style.display="none";d?(g.innerHTML="M",g.style.display="block"):(g.innerHTML="S",g.style.display="none");c.appendChild(g);c.appendChild(e);c.appendChild(f);c.addEventListener("click",function(a){var b=a.target.getAttribute("name");b&&b.length?(CORE.Sheets.changeSheet(b),CORE.Event.resize(),CORE.Sheets.setActiveSheet(b)):"BUTTON"===a.target.nodeName&&(b=a.target.parentNode.getAttribute("name"))&&
CORE.Sheets.deleteSheet(b)});d?CORE.DOM.Sheets.insertBefore(c,CORE.DOM.Sheets.children[0]):CORE.DOM.Sheets.appendChild(c);CORE.Sheets.changeSheet(CORE.CurrentSheet,1);CORE.DOM.Output.classList.add("pullDown");setTimeout(function(){CORE.DOM.Output.classList.remove("pullDown")},275);CORE.Event.resize();CORE.Sheets[CORE.CurrentSheet].Selector.selectCell(1,1);CORE.Sheets.setActiveSheet(CORE.CurrentSheet)}};
CORE.Sheets.prototype.deleteSheet=function(a){var b=this;CORE.Sheets[a]&&1<Object.keys(CORE.Sheets).length&&CORE_UI.Modal("<h3 class='modalTitle'>Do you really want to delete "+a+"?</h3>","<button class='mui-btn mui-btn-primary mui-btn-lg alertButton alertOk' name='ok'>Ok</button><button class='mui-btn mui-btn-primary mui-btn-lg alertButton alertAbort' name='abort'>Abort</button>",function(c){"ok"===c&&b.killSwitchSheet(a)})};
CORE.Sheets.prototype.killSwitchSheet=function(a){if(a===CORE.CurrentSheet){var b=void 0,c;for(c in CORE.Sheets)c===a&&(b?(this.changeSheet(b),CORE.$.killSheet(a),this.setActiveSheet(b)):(CORE.$.killSheet(a),b=Object.keys(CORE.Sheets)[0],this.changeSheet(b),this.setActiveSheet(c))),b=c;CORE.Event.resize()}else CORE.$.killSheet(a),this.changeSheet(CORE.CurrentSheet),this.setActiveSheet(CORE.CurrentSheet)};
CORE.Sheets.prototype.changeSheet=function(a,b){CORE.CurrentSheet=a;b||(CORE.DOM.Output.classList.add("fadeIn"),setTimeout(function(){CORE.DOM.Output.classList.remove("fadeIn")},275));CORE.Connector.connected&&CORE.Connector.action("changeSheet",{sheet:a})};
CORE.Sheets.prototype.setActiveSheet=function(a){for(var b=null,c=!1,d=0;d<CORE.DOM.Sheets.children.length;++d){CORE.DOM.Sheets.children[d].classList.remove("activeSheet","activeMasterSheet");b=CORE.DOM.Sheets.children[d].getAttribute("name");CORE.Sheets[b]||CORE.DOM.Sheets.children[d].parentNode.removeChild(CORE.DOM.Sheets.children[d]);CORE.Sheets[b]&&CORE.Sheets[b].Settings.master&&(c=!0);if(c&&CORE.Sheets[b]&&!CORE.Sheets[b].Settings.master)for(var e=0;e<CORE.DOM.Sheets.children[d].children.length;++e)"sheetType"===
CORE.DOM.Sheets.children[d].children[e].className&&(CORE.DOM.Sheets.children[d].children[e].style.display="block");else if(!c&&CORE.DOM.Sheets.children[d]&&CORE.DOM.Sheets.children[d].children)for(e=0;e<CORE.DOM.Sheets.children[d].children.length;++e)"sheetType"===CORE.DOM.Sheets.children[d].children[e].className&&(CORE.DOM.Sheets.children[d].children[e].style.display="none");b===a&&(CORE.Sheets[b]&&CORE.Sheets[b].Settings.master?(c=!0,CORE.DOM.Sheets.children[d].classList.add("activeMasterSheet")):
CORE.DOM.Sheets.children[d].classList.add("activeSheet"))}};
CORE.Grid=function(){this.Settings={master:!1,x:0,y:0,scrolledX:0,scrolledY:0,keyScrolledX:0,keyScrolledY:0,cellResizedX:0,cellResizedY:0,lastScrollX:0,lastScrollY:0,redrawOnZero:!1};this.CellTemplate={Width:100,Height:25};this.mouseMoveDirection={oldX:0,oldY:0,directionX:null,directionY:null,lastAction:null};this.customCellSizes={alphabetical:{},numeric:{},array:[]};this.cellArray=[];this.mouseMode=CORE.Settings.Mobile?"touchmove":"mouseover";this.Templates={Cell:{element:"div","class":"row",style:{height:this.CellTemplate.Height,
width:this.CellTemplate.Width}},Menu:{Alphabetical:{element:"div","class":"row cell_dark_alpha",style:{height:this.CellTemplate.Height,width:this.CellTemplate.Width}},Numeric:{element:"div","class":"row cell_dark_number",style:{height:this.CellTemplate.Height,width:this.CellTemplate.Width/2}}}};this.Input={Touch:{lastY:0,lastX:0},Mouse:{Pressed:!1,lastMousePosition:{x:0,y:0},CellResize:!1,Edit:!1,Extend:!1,LiveCellEdit:!1,lastMouseDown:0,lastMouseDownCell:{Letter:1,Number:1},lastMouseScroll:(new Date).getTime(),
startedMouseWipe:!1},Keyboard:{Shift:!1,Strg:!1,Tab:!1,lastKeyPress:0},lastAction:{scrollY:!1,scrollX:!1}};this.calculateGrid()};CORE.Grid.prototype=CORE.Grid;CORE.Grid.prototype.constructor=CORE.Grid;CORE.Grid.prototype.calculateGrid=function(){this.Settings.x=Math.ceil(-(CORE.Settings.Width/this.CellTemplate.Width));this.Settings.y=Math.ceil(-(CORE.Settings.Height/this.CellTemplate.Height));this.Settings.x=~this.Settings.x+2;this.Settings.y=~this.Settings.y+1-3};
CORE.Grid.prototype.cellHover=function(a){CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit||(CORE.DOM.CurrentCell.innerHTML=a.target.getAttribute("name"))};CORE.Grid.prototype.addCellListeners=function(){for(var a=0;a<CORE.DOM.Output.children.length;++a)CORE.DOM.Output.children[a].addEventListener(this.mouseMode,this.cellHover,!1)};
CORE.Grid.prototype.generateCells=function(){var a=1,b=0,c=null,d=0,e=0,f,g=0,h=null,k=this.Templates.Cell.style.width,m=this.Templates.Cell.style.height,l="";this.cellArray=Array(this.Settings.x*this.Settings.y);this.generateMenu();for(var n=0;n<this.Settings.x;++n)for(var p=0;p<this.Settings.y;++p)f=this.CellTemplate.Width*n,g=this.CellTemplate.Height*p,d+=1,b+=1,d<this.Settings.y?c=CORE.$.numberToAlpha(a):1===d%this.Settings.y&&(a+=1,c=CORE.$.numberToAlpha(a)),h="height: "+m+"px; width: "+k+"px;",
h+=" left:"+f+"px; top: "+g+"px;",l+="<"+this.Templates.Cell.element+' name="'+c+b+'" id="'+d+'" class="'+this.Templates.Cell["class"]+'" style="'+h+'">',CORE.Cells.Used[CORE.CurrentSheet][c]&&CORE.Cells.Used[CORE.CurrentSheet][c][c+b]&&(l+=CORE.Cells.Used[CORE.CurrentSheet][c][c+b].Content),l+="</"+this.Templates.Cell.element+">",0===d%this.Settings.y&&(b=0),this.cellArray[e]={id:d,x:n,y:p,origWidth:k,origHeight:m,origTop:g,origLeft:f},e++;CORE.DOM.Output.innerHTML=l;this.cacheDOM();this.addCellListeners();
CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit&&this.getEditSelection(CORE.Sheets[CORE.CurrentSheet].Selector.Edit)};CORE.Grid.prototype.isMasterSheet=function(a){return this.Settings.master?!0:!1};CORE.Grid.prototype.cacheDOM=function(){var a=CORE.DOM.Output.children,b=CORE.DOM.Output.children.length;CORE.DOM.Cache=null;delete CORE.DOM.Cache;CORE.DOM.Cache={};CORE.DOM.CacheArray=Array(b);for(var c=0;c<b;++c)CORE.DOM.Cache[c]=a[c],CORE.DOM.CacheArray[c]=a[c]};
CORE.Grid.prototype.generateMenu=function(){var a=0,b=0,c=this.Settings.x,d=this.Settings.y,c=c+1,d=d+1;CORE.DOM.HorizontalMenu.innerHTML=CORE.DOM.VerticalMenu.innerHTML="";for(var e=0;e<c;++e)for(var f=0;f<d;++f)0<e&&e!==a&&(a=e,this.generateMenuNode(CORE.$.numberToAlpha(a+this.Settings.scrolledX),CORE.DOM.HorizontalMenu,e,f,"alpha")),0<f&&f>b&&(b=f,this.generateMenuNode(b+this.Settings.scrolledY,CORE.DOM.VerticalMenu,e,f,"numeric"))};
CORE.Grid.prototype.generateMenuNode=function(a,b,c,d,e){var f=0,g="numeric"===e?this.Templates.Menu.Numeric:this.Templates.Menu.Alphabetical,h=g.style.width,k=g.style.height,m=null;c*=this.CellTemplate.Width;f=this.CellTemplate.Height*d;"alpha"===e&&this.customCellSizes.alphabetical[a]&&(h+=this.customCellSizes.alphabetical[a].Width);if("alpha"===e)for(var l in this.customCellSizes.alphabetical)CORE.$.alphaToNumber(a)>CORE.$.alphaToNumber(l)&&(c+=this.customCellSizes.alphabetical[l].Width),this.Settings.scrolledX&&
this.Settings.scrolledX>=CORE.$.alphaToNumber(l)&&(c-=this.customCellSizes.alphabetical[l].Width);"numeric"===e&&this.customCellSizes.numeric[a]&&(k+=this.customCellSizes.numeric[a].Height);if("numeric"===e)for(l in this.customCellSizes.numeric)a>l&&(f+=this.customCellSizes.numeric[l].Height),this.Settings.scrolledY&&this.Settings.scrolledY>=l&&(f-=this.customCellSizes.numeric[l].Height);"numeric"===e?m="height: "+k+"px; width: "+h+"px;"+(" left:"+c+"px; top: "+f+"px;"):"alpha"===e&&(m="height: "+
k+"px; width: "+(h+1)+"px;"+(" left:"+c+"px; top: "+f+"px;"));"numeric"===e&&(m+=" line-height: "+(k-8)+"px;");d=null;d="alpha"===e?this.createAlphabeticalMenuCell(a,m,g):this.createNumericMenuCell(a,m,g);b.appendChild(d)};
CORE.Grid.prototype.createAlphabeticalMenuCell=function(a,b,c){var d=this,e=document.createElement(c.element);e.className=c["class"];e.setAttribute("clicked",0);e.setAttribute("style",b);e.setAttribute("timestamp",(new Date).getTime());e.innerHTML=a;e.addEventListener(CORE.Events.mouseDown,function(a){150>=(new Date).getTime()-parseInt(this.getAttribute("timestamp"))?CORE.Sheets[CORE.CurrentSheet].Selector.masterSelect(a.target.innerHTML):this.setAttribute("timestamp",a.timeStamp);this.setAttribute("clicked",
1);CORE.Sheets[CORE.CurrentSheet].Input.Mouse.CellResize=!0});e.addEventListener(CORE.Events.mouseUp,function(a){this.setAttribute("clicked",0);CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY=!1;this.setAttribute("timestamp",a.timeStamp);d.isMasterSheet()&&CORE.Styler.inheritResize(a.target.innerHTML,d.customCellSizes.alphabetical[a.target.innerHTML].Width)});e.addEventListener(CORE.Events.mouseOut,function(a){this.setAttribute("clicked",0)});e.addEventListener(CORE.Events.mouseMove,function(a){var b=
0,c=0;CORE.Settings.Mobile?(b=a.touches[0].pageX-this.offsetLeft,c=a.touches[0].pageY-this.offsetTop,d.mouseMoveDirection.directionX=a.touches[0].pageX<d.mouseMoveDirection.oldX?"left":a.touches[0].pageX>d.mouseMoveDirection.oldX?"right":null,d.mouseMoveDirection.oldX=a.touches[0].pageX):(b=a.pageX-this.offsetLeft,c=a.pageY-this.offsetTop,d.mouseMoveDirection.directionX=a.pageX<d.mouseMoveDirection.oldX?"left":a.pageX>d.mouseMoveDirection.oldX?"right":null,d.mouseMoveDirection.oldX=a.pageX);-35<=
b+c?(a.target.style.cursor="col-resize","1"===a.target.getAttribute("clicked")&&(b=a.target.innerHTML,d.customCellSizes.alphabetical[b]||(d.customCellSizes.alphabetical[b]={Width:0,Height:0}),"right"===d.mouseMoveDirection.directionX?(a.target.style.width=parseInt(a.target.style.width)+2+"px",d.customCellSizes.alphabetical[b].Width+=2,d.Settings.cellResizedX+=2):"left"===d.mouseMoveDirection.directionX&&(parseInt(a.target.style.width)>d.CellTemplate.Width?(a.target.style.width=parseInt(a.target.style.width)-
2+"px",d.customCellSizes.alphabetical[b].Width-=2,d.Settings.cellResizedX-=2):(a.target.style.width=d.CellTemplate.Width+"px",d.customCellSizes.alphabetical[b].Width=0)))):a.target.style.cursor="pointer"});return e};
CORE.Grid.prototype.createNumericMenuCell=function(a,b,c){var d=this,e=document.createElement(c.element);e.className=c["class"];e.setAttribute("clicked",0);e.setAttribute("style",b);e.setAttribute("timestamp",(new Date).getTime());e.innerHTML=a;e.addEventListener(CORE.Events.mouseDown,function(a){150>=(new Date).getTime()-parseInt(this.getAttribute("timestamp"))?CORE.Sheets[CORE.CurrentSheet].Selector.masterSelect(parseInt(a.target.innerHTML)):this.setAttribute("timestamp",a.timeStamp);this.setAttribute("clicked",
1);CORE.Sheets[CORE.CurrentSheet].Input.Mouse.CellResize=!0});e.addEventListener(CORE.Events.mouseUp,function(a){this.setAttribute("clicked",0);d.isMasterSheet()&&CORE.Styler.inheritResize(a.target.innerHTML,d.customCellSizes.numeric[a.target.innerHTML].Height)});e.addEventListener(CORE.Events.mouseOut,function(a){this.setAttribute("clicked",0)});e.addEventListener(CORE.Events.mouseMove,function(a){var b=0,c=0;CORE.Settings.Mobile?(b=a.touches[0].pageX-this.offsetLeft,c=a.touches[0].pageY-this.offsetTop,
d.mouseMoveDirection.directionY=a.touches[0].pageY<d.mouseMoveDirection.oldY?"up":a.touches[0].pageY>d.mouseMoveDirection.oldY?"down":null,d.mouseMoveDirection.oldY=a.touches[0].pageY):(b=a.pageX-this.offsetLeft,c=a.pageY-this.offsetTop,d.mouseMoveDirection.directionY=a.pageY<d.mouseMoveDirection.oldY?"up":a.pageY>d.mouseMoveDirection.oldY?"down":null,d.mouseMoveDirection.oldY=a.pageY);-35<=b+c?(a.target.style.cursor="row-resize","1"===a.target.getAttribute("clicked")&&(b=a.target.innerHTML,d.customCellSizes.numeric[b]||
(d.customCellSizes.numeric[b]={Width:0,Height:0},d.customCellSizes.array.push(parseInt(b))),"down"===d.mouseMoveDirection.directionY?(a.target.style.height=parseInt(a.target.style.height)+2+"px",d.customCellSizes.numeric[b].Height+=2,d.Settings.cellResizedY+=2):"up"===d.mouseMoveDirection.directionY&&(parseInt(a.target.style.height)>d.CellTemplate.Height?(a.target.style.height=parseInt(a.target.style.height)-2+"px",d.customCellSizes.numeric[b].Height-=2,d.Settings.cellResizedY-=2):(a.target.style.height=
d.CellTemplate.Height+"px",d.customCellSizes.numeric[b].Height=0)))):a.target.style.cursor="pointer"});return e};CORE.Grid.prototype.updateMenu=function(){this.Settings.cellResizedX||this.Settings.cellResizedY?this.generateMenu():this.updateMenuNoResizement()};
CORE.Grid.prototype.updateMenuNoResizement=function(){for(var a=0;a<this.Settings.y;++a)CORE.DOM.VerticalMenu.children[a].innerHTML=a+this.Settings.scrolledY+1;for(a=0;a<this.Settings.x;++a)CORE.DOM.HorizontalMenu.children[a].innerHTML=CORE.$.numberToAlpha(a+this.Settings.scrolledX+1)};
CORE.Grid.prototype.updateHeight=function(a,b){var c=this.Settings.x,d=this.Settings.y,e=this.Settings.y,f=0,g=0,h=null,g=0,h=0>=this.Settings.scrolledX?CORE.DOM.Output.children[0].getAttribute("name").match(CORE.REGEX.numbers).join(""):CORE.$.numberToAlpha(this.Settings.scrolledX+1);this.Settings.scrolledY=0>this.Settings.scrolledY?0:CORE.$.isSafeInteger(this.Settings.scrolledY);for(var k=0;k<c*d;++k)"down"===a?(g=this.Settings.scrolledY-b+1,g=k+b-f+g):"up"===a?(g=this.Settings.scrolledY+b+1,g=k-
b-f+g):(g=1,g=k+this.Settings.scrolledY-f+g),CORE.DOM.Output.children[k].setAttribute("name",h+g),this.removeCellStyling(k),CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns[h]?this.updateCellMasterStyling(h,k):CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows[g]&&this.updateCellMasterStyling(g,k),CORE.Cells.Used[CORE.CurrentSheet][h]&&CORE.Cells.Used[CORE.CurrentSheet][h][h+g]&&this.updateCellStyling(h,h+g,k),CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY||this.resizeHorizontal(h,
k),this.resizeVertical(g,k),0===(k+1)%e&&(h=CORE.$.numberToAlpha(CORE.$.alphaToNumber(h)+1),f=k+1)};
CORE.Grid.prototype.updateWidth=function(a){for(var b=0,c=this.Settings.x,d=this.Settings.y,e=0,f=0,g=null,c=c+1,d=d+1,h=0;h<c;++h)for(var k=0;k<d;++k){if(0<h&&h!==b)for(var b=h,m=0;m<d;++m)f=m+e-b-d,CORE.DOM.Output.children[f]&&CORE.DOM.Output.children[f].setAttribute("name",g+f);e+=1;g="right"===a||"left"===a?0===b?CORE.$.numberToAlpha(this.Settings.scrolledX+1):CORE.$.numberToAlpha(b+(this.Settings.scrolledX+1)):0===this.Settings.scrolledX?CORE.$.numberToAlpha(this.Settings.scrolledX+1):1===this.Settings.scrolledX?
CORE.$.numberToAlpha(this.Settings.scrolledX):CORE.$.numberToAlpha(this.Settings.scrolledX+1);this.Settings.scrolledX=CORE.$.isSafeInteger(this.Settings.scrolledX)}this.updateHeight("default",CORE.Settings.Scroll.Vertical)};
CORE.Grid.prototype.updateCellStyling=function(a,b,c){CORE.Cells.Used[CORE.CurrentSheet][a]&&CORE.Cells.Used[CORE.CurrentSheet][a][b]&&(void 0!==CORE.Cells.Used[CORE.CurrentSheet][a][b].Content&&null!==CORE.Cells.Used[CORE.CurrentSheet][a][b].Content&&(CORE.DOM.Cache[c].innerHTML=CORE.Cells.Used[CORE.CurrentSheet][a][b].Content),CORE.Cells.Used[CORE.CurrentSheet][a][b].Font&&(CORE.DOM.Cache[c].style.fontFamily=CORE.Cells.Used[CORE.CurrentSheet][a][b].Font),CORE.Cells.Used[CORE.CurrentSheet][a][b].FontSize&&
(CORE.DOM.Cache[c].style.fontSize=CORE.Cells.Used[CORE.CurrentSheet][a][b].FontSize+"px"),CORE.Cells.Used[CORE.CurrentSheet][a][b].Color&&(CORE.DOM.Cache[c].style.color=CORE.Cells.Used[CORE.CurrentSheet][a][b].Color),CORE.Cells.Used[CORE.CurrentSheet][a][b].FontBold&&(CORE.DOM.Cache[c].style.fontWeight="bold"),CORE.Cells.Used[CORE.CurrentSheet][a][b].FontItalic&&(CORE.DOM.Cache[c].style.fontStyle="italic"),CORE.Cells.Used[CORE.CurrentSheet][a][b].FontUnderlined&&(CORE.DOM.Cache[c].style.textDecoration=
"underline"),CORE.Cells.Used[CORE.CurrentSheet][a][b].BackgroundColor&&(CORE.DOM.Cache[c].style.background=CORE.Cells.Used[CORE.CurrentSheet][a][b].BackgroundColor),CORE.Cells.Used[CORE.CurrentSheet][a][b].Border.used&&(CORE.Cells.Used[CORE.CurrentSheet][a][b].Border.left&&(CORE.DOM.Cache[c].style.borderLeft="2px solid black"),CORE.Cells.Used[CORE.CurrentSheet][a][b].Border.right&&(CORE.DOM.Cache[c].style.borderRight="2px solid black"),CORE.Cells.Used[CORE.CurrentSheet][a][b].Border.top&&(CORE.DOM.Cache[c].style.borderTop=
"2px solid black"),CORE.Cells.Used[CORE.CurrentSheet][a][b].Border.bottom&&(CORE.DOM.Cache[c].style.borderBottom="2px solid black"),CORE.Cells.Used[CORE.CurrentSheet][a][b].Border.full&&(CORE.DOM.Cache[c].style.border="2px solid black")))};
CORE.Grid.prototype.updateCellMasterStyling=function(a,b){var c=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns[a]||CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows[a];c.Font&&(CORE.DOM.Cache[b].style.fontFamily=c.Font);c.FontSize&&(CORE.DOM.Cache[b].style.fontSize=c.FontSize+"px");c.Color&&(CORE.DOM.Cache[b].style.color=c.Color);c.FontBold&&(CORE.DOM.Cache[b].style.fontWeight="bold");c.FontItalic&&(CORE.DOM.Cache[b].style.fontStyle="italic");c.FontUnderlined&&(CORE.DOM.Cache[b].style.textDecoration=
"underline");c.BackgroundColor&&(CORE.DOM.Cache[b].style.background=c.BackgroundColor);c.Border&&c.Border.used&&(c.Border.left&&(CORE.DOM.Cache[b].style.borderLeft="2px solid black"),c.Border.right&&(CORE.DOM.Cache[b].style.borderRight="2px solid black"),c.Border.top&&(CORE.DOM.Cache[b].style.borderTop="2px solid black"),c.Border.bottom&&(CORE.DOM.Cache[b].style.borderBottom="2px solid black"),c.Border.full&&(CORE.DOM.Cache[b].style.border="2px solid black"))};
CORE.Grid.prototype.removeCellStyling=function(a){CORE.DOM.Cache[a].style.borderLeft="";CORE.DOM.Cache[a].style.borderRight="";CORE.DOM.Cache[a].style.borderTop="";CORE.DOM.Cache[a].style.borderBottom="";CORE.DOM.Cache[a].style.border="";CORE.DOM.Cache[a].style.fontFamily="";CORE.DOM.Cache[a].style.fontSize="12px";CORE.DOM.Cache[a].style.fontStyle="normal";CORE.DOM.Cache[a].style.fontWeight="normal";CORE.DOM.Cache[a].style.textDecoration="none";CORE.DOM.Cache[a].style.background="#fff";CORE.DOM.Cache[a].style.color=
"#000";CORE.DOM.Cache[a].innerHTML=""};
CORE.Grid.prototype.resizeHorizontal=function(a,b){var c=this.customCellSizes.alphabetical,d=0,e=CORE.DOM.Cache[b].style;c[a]?(e.width=this.cellArray[b].origWidth+c[a].Width+"px",e.left=this.cellArray[b].origLeft+"px"):e.width=this.cellArray[b].origWidth+"px";var f=CORE.$.alphaToNumber(a),g;for(g in c){var h=CORE.$.alphaToNumber(g);f>h&&(d+=c[g].Width,e.left=this.cellArray[b].origLeft+d+"px");0<this.Settings.scrolledX&&h<=this.Settings.scrolledX&&(e.left=this.cellArray[b].origLeft+"px");f>=h&&this.Settings.scrolledX>=
h&&(d-=c[g].Width,e.left=this.cellArray[b].origLeft+d+"px")}};
CORE.Grid.prototype.resizeVertical=function(a,b){var c=this.customCellSizes.numeric,d=0,e=CORE.DOM.Cache[b].style,f=this.cellArray[b].origHeight,g=this.cellArray[b].origTop;c[a]?(e.height=f+c[a].Height+"px",e.top=g+"px"):e.height=f+"px";if(this.verticalInView(a)){CORE.Sheets[CORE.CurrentSheet].Settings.redrawOnZero=!0;for(var h in c)a>h&&(d+=c[h].Height),e.top=g+d+"px",0<this.Settings.scrolledY&&h<=this.Settings.scrolledY&&(e.top=g+"px"),a>=h&&this.Settings.scrolledY>=h&&(d-=c[h].Height,e.top=g+d+
"px")}};CORE.Grid.prototype.verticalInView=function(a){a=this.customCellSizes.array.length;for(var b=0;b<a;++b)if(this.customCellSizes.array[b]<=this.Settings.scrolledY+(this.Settings.y+this.Settings.lastScrollY)&&this.customCellSizes.array[b]>=this.Settings.scrolledY-this.Settings.lastScrollY)return!0;return!1};
CORE.Grid.prototype.Cell=function(){this.FontSize=this.Font=this.Content=this.Formula=this.BackgroundColor=this.Color=null;this.FontUnderlined=this.FontItalic=this.FontBold=!1;this.Border={top:!1,bottom:!1,left:!1,right:!1,full:!1,style:!1,color:null,used:!1}};CORE.Grid.prototype.Cell=CORE.Grid.Cell;CORE.Grid.prototype.LiveCell=function(){this.Url="";this.RefreshTime=2500;this.Active=!1;this.Data=""};CORE.Injector=function(){};CORE.Injector.prototype=CORE.Injector;
CORE.Injector.prototype.constructor=CORE.Injector;
CORE.Injector.prototype.getAlphaUsedCells=function(a,b,c){var d=null,d=c&&"object"===typeof c?c:CORE.Sheets[b].Selector.Selected.First;b=CORE.Cells.Used[b];var e,f=[],g;for(g in b)if(b[g]&&CORE.$.alphaToNumber(g)>=d.Letter){for(var h in b[g]){switch(a){case "insert":e=CORE.$.numberToAlpha(CORE.$.alphaToNumber(h.match(CORE.REGEX.numbers).join(""))+1);break;case "delete":e=CORE.$.numberToAlpha(CORE.$.alphaToNumber(h.match(CORE.REGEX.numbers).join(""))-1)}c=~~h.match(CORE.REGEX.letters).join("");b[g][e+
c]=b[g][h];delete b[g][h]}f.push({old:g,"new":e})}return f};CORE.Injector.prototype.getAlphaMasterColumns=function(a,b,c){var d=null,d=c&&"object"===typeof c?c:CORE.Sheets[b].Selector.Selected.First;b=CORE.Sheets[b].Selector.masterSelected.Columns;c=[];for(var e in b)if(b[e]&&CORE.$.alphaToNumber(e)>=d.Letter)switch(a){case "insert":c.push({old:e,"new":CORE.$.numberToAlpha(CORE.$.alphaToNumber(e)+1)});break;case "delete":c.push({old:e,"new":CORE.$.numberToAlpha(CORE.$.alphaToNumber(e)-1)})}return c};
CORE.Injector.prototype.getAlphaCustomizedCells=function(a,b,c){var d=null,d=c&&"object"===typeof c?c:CORE.Sheets[b].Selector.Selected.First;b=CORE.Sheets[b].customCellSizes.alphabetical;c=[];for(var e in b)if(b[e]&&CORE.$.alphaToNumber(e)>=d.Letter)switch(a){case "insert":c.push({old:e,"new":CORE.$.numberToAlpha(CORE.$.alphaToNumber(e)+1)});break;case "delete":c.push({old:e,"new":CORE.$.numberToAlpha(CORE.$.alphaToNumber(e)-1)})}return c};
CORE.Injector.prototype.getNumericUsedCells=function(a,b,c){var d=null,d=c&&"object"===typeof c?c:CORE.Sheets[b].Selector.Selected.First;b=CORE.Cells.Used[b];var e,f=null,g=[],h;for(h in b)for(var k in b[h])if(f=parseInt(k.match(CORE.REGEX.letters).join("")),c=k.match(CORE.REGEX.numbers).join(""),f>=d.Number){switch(a){case "insert":e=f+1;break;case "delete":e=f-1}g.push({old:f,"new":e,letter:c})}return g};
CORE.Injector.prototype.getNumericCustomizedCells=function(a,b,c){var d=null,d=c&&"object"===typeof c?c:CORE.Sheets[b].Selector.Selected.First;b=CORE.Sheets[b].customCellSizes.numeric;c=[];var e=0,f;for(f in b)if(e=parseInt(f),e>=d.Number)switch(a){case "insert":c.push({old:e,"new":e+1});break;case "delete":c.push({old:e,"new":e-1})}return c};
CORE.Injector.prototype.getNumericMasterRows=function(a,b,c){var d=null,d=c&&"object"===typeof c?c:CORE.Sheets[b].Selector.Selected.First;b=CORE.Sheets[b].Selector.masterSelected.Rows;c=[];var e=0,f;for(f in b)if(e=parseInt(f),e>=d.Number)switch(a){case "insert":c.push({old:e,"new":e+1});break;case "delete":c.push({old:e,"new":e-1})}return c};
CORE.Injector.prototype.insertColumn=function(){var a=arguments[0]||CORE.CurrentSheet,b=arguments[1]||CORE.Sheets[a].Selector.Selected.First;this.insertColumn_MasterColumns(a,b);this.insertColumn_Columns(a,b);this.insertColumn_Cells(a,b);!arguments.length&&CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&CORE.Styler.inheritInjection(CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First,"insertColumn");CORE.Event.redraw(a);CORE.Sheets[a].Selector.getSelection()};
CORE.Injector.prototype.insertColumn_MasterColumns=function(a,b){for(var c=CORE.Sheets[a].Selector.masterSelected.Columns,d=this.getAlphaMasterColumns("insert",a,b),d=d.sortOn("old"),e=d.length;e--;){var f=d[e];c[f["new"]]=c[f.old];delete c[f.old]}};CORE.Injector.prototype.insertColumn_Columns=function(a,b){for(var c=CORE.Sheets[a].customCellSizes.alphabetical,d=this.getAlphaCustomizedCells("insert",a,b),d=d.sortOn("old"),e=d.length;e--;){var f=d[e];c[f["new"]]=c[f.old];delete c[f.old]}};
CORE.Injector.prototype.insertColumn_Cells=function(a,b){for(var c=CORE.Cells.Used[a],d=this.getAlphaUsedCells("insert",a,b),d=d.sortOn("old"),e=d.length;e--;){var f=d[e];c[f["new"]]=c[f.old];delete c[f.old]}};
CORE.Injector.prototype.insertRow=function(){var a=arguments[0]||CORE.CurrentSheet,b=arguments[1]||CORE.Sheets[a].Selector.Selected.First;this.insertRow_MasterRows(a,b);this.insertRow_Rows(a,b);this.insertRow_Cells(a,b);!arguments.length&&CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&CORE.Styler.inheritInjection(CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First,"insertRow");CORE.Event.redraw(a);CORE.Sheets[a].Selector.getSelection()};
CORE.Injector.prototype.insertRow_MasterRows=function(a,b){for(var c=this.getNumericMasterRows("insert",a,b),d=CORE.Sheets[a].Selector.masterSelected.Rows,c=c.sortOn("old"),e=c.length;e--;){var f=c[e];d[f["new"]]=d[f.old];delete d[f.old]}};CORE.Injector.prototype.insertRow_Rows=function(a,b){for(var c=CORE.Sheets[a].customCellSizes.numeric,d=this.getNumericCustomizedCells("insert",a,b),d=d.sortOn("old"),e=d.length;e--;){var f=d[e];c[f["new"]]=c[f.old];delete c[f.old]}};
CORE.Injector.prototype.insertRow_Cells=function(a,b){for(var c=CORE.Cells.Used[a],d=this.getNumericUsedCells("insert",a,b),d=d.sortOn("old"),e=d.length;e--;){var f=d[e],g=f.letter+f.old;c[f.letter][f.letter+f["new"]]=c[f.letter][g];delete c[f.letter][g]}};
CORE.Injector.prototype.deleteColumn=function(){var a=arguments[0]||CORE.CurrentSheet,b=arguments[1]||CORE.Sheets[a].Selector.Selected.First;this.deleteColumn_MasterColumns(a,b);this.deleteColumn_Columns(a,b);this.deleteColumn_Cells(a,b);!arguments.length&&CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&CORE.Styler.inheritInjection(CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First,"deleteColumn");CORE.Event.redraw(a);CORE.Sheets[a].Selector.getSelection()};
CORE.Injector.prototype.deleteColumn_MasterColumns=function(a,b){for(var c=CORE.Sheets[a].Selector.masterSelected.Columns,d=this.getAlphaMasterColumns("delete",a,b),d=d.sortOn("old"),e=0;e<d.length;++e){var f=d[e];CORE.$.alphaToNumber(f["new"])<b.Letter||(c[f["new"]]=c[f.old]);delete c[f.old]}};
CORE.Injector.prototype.deleteColumn_Columns=function(a,b){for(var c=CORE.Sheets[a].customCellSizes.alphabetical,d=this.getAlphaCustomizedCells("delete",a,b),d=d.sortOn("old"),e=0;e<d.length;++e){var f=d[e];CORE.$.alphaToNumber(f["new"])<b.Letter||(c[f["new"]]=c[f.old]);delete c[f.old]}};
CORE.Injector.prototype.deleteColumn_Cells=function(a,b){for(var c=CORE.Cells.Used[a],d=this.getAlphaUsedCells("delete",a,b),d=d.sortOn("old"),e=0;e<d.length;++e){var f=d[e];CORE.$.alphaToNumber(f["new"])<b.Letter||(c[f["new"]]=c[f.old]);delete c[f.old]}};
CORE.Injector.prototype.deleteRow=function(){var a=arguments[0]||CORE.CurrentSheet,b=arguments[1]||CORE.Sheets[a].Selector.Selected.First;this.deleteRow_MasterRows(a,b);this.deleteRow_Rows(a,b);this.deleteRow_Cells(a,b);!arguments.length&&CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&CORE.Styler.inheritInjection(CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First,"deleteRow");CORE.Event.redraw(a);CORE.Sheets[a].Selector.getSelection()};
CORE.Injector.prototype.deleteRow_MasterRows=function(a,b){for(var c=CORE.Sheets[a].Selector.masterSelected.Rows,d=this.getNumericMasterRows("delete",a,b),d=d.sortOn("old"),e=0;e<d.length;++e){var f=d[e];f["new"]<b||(c[f["new"]]=c[f.old]);delete c[f.old]}};CORE.Injector.prototype.deleteRow_Rows=function(a,b){for(var c=CORE.Sheets[a].customCellSizes.numeric,d=this.getNumericCustomizedCells("delete",a,b),d=d.sortOn("old"),e=0;e<d.length;++e){var f=d[e];f["new"]<b||(c[f["new"]]=c[f.old]);delete c[f.old]}};
CORE.Injector.prototype.deleteRow_Cells=function(a,b){for(var c=CORE.Cells.Used[a],d=this.getNumericUsedCells("delete",a,b),d=d.sortOn("old"),e=0;e<d.length;++e){var f=d[e];f["new"]<b||(c[f.letter][f.letter+f["new"]]=c[f.letter][f.letter+f.old]);delete c[f.letter][f.letter+f.old]}};CORE.Extender=function(){};CORE.Extender.prototype=CORE.Extender;CORE.Extender.prototype.constructor=CORE.Extender;
CORE.Extender.prototype.extend=function(){for(var a=CORE.Sheets[CORE.CurrentSheet].Selector.SelectedCells,b={},c={},d=0;d<a.length;++d){var e=CORE.$.numberToAlpha(a[d].letter),f=a[d].number,g=CORE.Cells.Used[CORE.CurrentSheet][e];c[e]||(c[e]={array:[],mode:null});b[e]||(b[e]=[]);g&&g[e+f]?(g=g[e+f],void 0!==g.Content&&null!==g.Content&&(null===c[e].mode&&(isNaN(g.Content)?c[e].mode="string":c[e].mode="numeric"),2>b[e].length&&b[e].push(g.Content)),c[e].array.push({letter:a[d].letter,number:a[d].number,
value:g.Content})):c[e].array.push({letter:a[d].letter,number:a[d].number,value:null})}if(Object.keys(c).length)for(d in c)b[d]&&("numeric"===c[d].mode?this.extendNumbers(c[d].array,b[d]):"string"===c[d].mode&&this.extendStrings(c[d].array,b[d]))};
CORE.Extender.prototype.extendButton=function(){var a=document.createElement("button");a.className="extendButton";a.addEventListener(CORE.Events.mouseDown,function(a){CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Extend=!0});a.addEventListener(CORE.Events.mouseMove,function(a){a.target.style.cursor="crosshair"});return a};
CORE.Extender.prototype.updateCells=function(a){for(var b=0;b<a.length;++b){var c=CORE.$.numberToAlpha(a[b].letter),d=a[b].number;CORE.Cells.Used[CORE.CurrentSheet][c]&&(CORE.Cells.Used[CORE.CurrentSheet][c][c+d]||CORE.$.registerCell({letter:c,number:d}),CORE.Cells.Used[CORE.CurrentSheet][c][c+d].Content=a[b].value)}};
CORE.Extender.prototype.extendNumbers=function(a,b){var c=0,d=!1;b[0]=parseInt(b[0]);b[1]=parseInt(b[1]);var e=b[1]+b[0];if(void 0!==e&&null!==e&&!isNaN(e))c=b[1]-b[0];else if(void 0===e||null===e||isNaN(e))d=!0;var e=CORE.Sheets[CORE.CurrentSheet].Selector.SelectedCells,f=0;if(!d)for(var g=0;g<e.length;++g)if(void 0!==b[g]&&null!==b[g])f=parseInt(b[g]);else if(void 0===b[g]||null===b[g])f+=c,b[g]=f;if(d)for(g=0;g<a.length;++g)a[g].value=b[0];else for(g=0;g<a.length;++g)a[g].value=parseInt(b[g]);
this.updateCells(a)};
CORE.Extender.prototype.extendStrings=function(a,b){var c=0,d=!1,e=CORE.Sheets[CORE.CurrentSheet].Selector.SelectedCells,f=0,g=0,h=b[0],g=null;if(g=b[0].match(CORE.REGEX.letters))b[0]=parseInt(g.join(""));b[1]?(g=b[1].match(CORE.REGEX.letters))?b[1]=parseInt(g.join("")):b[1]=void 0:b[1]=void 0;g=b[1]+b[0];if(void 0!==g&&null!==g&&!isNaN(g))c=b[1]-b[0];else if(void 0===g||null===g||isNaN(g))d=!0;if(!d)for(g=0;g<e.length;++g)if(void 0!==b[g]&&null!==b[g])f=parseInt(b[g]);else if(void 0===b[g]||null===
b[g])f+=c,b[g]=f;if(d)for(g=0;g<a.length;++g)a[g].value=h;else for(g=0;g<a.length;++g)a[g].value=CORE.$.replaceNumbers(h,String(b[g]));this.updateCells(a)};
CORE.Selector=function(){this.Selected={First:{Letter:1,Number:1},Last:{Letter:1,Number:1}};this.allSelected=!1;this.MenuSelection={Horizontal:0,Vertical:0};this.SelectedCells=[];this.parentSelectedCell={Letter:1,Number:1};this.cellFocusSwitch=!1;this.selectionMode=null;this.masterSelected={Current:null,Columns:{},Rows:{}};this.Selected={First:{Letter:0,Number:0},Last:{Letter:0,Number:0}};this.Select={Letter:0,Number:0};this.Edit=null};CORE.Selector.prototype=CORE.Selector;
CORE.Selector.prototype.constructor=CORE.Selector;
CORE.Selector.prototype.addCellHoverEffect=function(){for(var a=0,b=0,a=0,c="",d=1===this.SelectedCells.length?!0:!1,e=d?"single_row_hovered":"row_hovered",f=0;f<this.SelectedCells.length;++f)a=this.SelectedCells[f].letter,b=this.SelectedCells[f].number,c=CORE.$.numberToAlpha(a),1===this.SelectedCells.length&&CORE_UI.updateCellStyleMenu(this.SelectedCells[f]),a=CORE.$.getCell({letter:a,number:b}),0<=a&&CORE.DOM.CacheArray[a]&&(this.appendSelectionStyling(c,b,a,e),d?CORE.DOM.CacheArray[a].appendChild(CORE.Extender.extendButton()):
f+1===this.SelectedCells.length&&CORE.DOM.CacheArray[a].appendChild(CORE.Extender.extendButton()));1<this.SelectedCells.length&&this.drawSelectionOuterBorder()};
CORE.Selector.prototype.appendSelectionStyling=function(a,b,c,d){CORE.Cells.Used[CORE.CurrentSheet][a]&&CORE.Cells.Used[CORE.CurrentSheet][a][a+b]&&null!==CORE.Cells.Used[CORE.CurrentSheet][a][a+b].BackgroundColor?(CORE.DOM.CacheArray[c].style.background=CORE.Cells.Used[CORE.CurrentSheet][a][a+b].BackgroundColor.replace(")",", 0.55)").replace("rgb","rgba"),1===this.SelectedCells.length&&CORE.DOM.CacheArray[c].classList.add(d)):CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns[a]&&null!==
CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns[a].BackgroundColor?CORE.DOM.CacheArray[c].style.background=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns[a].BackgroundColor.replace(")",", 0.55)").replace("rgb","rgba"):CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows[b]&&null!==CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows[b].BackgroundColor?CORE.DOM.CacheArray[c].style.background=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows[b].BackgroundColor.replace(")",
", 0.55)").replace("rgb","rgba"):CORE.DOM.CacheArray[c].classList.add(d)};CORE.Selector.prototype.allCellHoverEffect=function(){this.allSelectOuterBorder();for(var a=0;a<this.SelectedCells.length;++a){var b=this.SelectedCells[a].letter,c=this.SelectedCells[a].number,d=CORE.$.numberToAlpha(b),b=CORE.$.getCell({letter:b,number:c});0<=b&&CORE.DOM.CacheArray[b]&&this.appendSelectionStyling(d,c,b,"row_hovered")}this.SelectedCells=[]};
CORE.Selector.prototype.deleteCellHoverEffect=function(){var a=0,b=0,b="",c=1===this.SelectedCells.length?!0:!1,d=c?"single_row_hovered":"row_hovered";this.allSelected&&(d="row_hovered");for(var e=0;e<CORE.DOM.CacheArray.length;++e)if(CORE.DOM.CacheArray[e].classList.remove(d,"border_top","border_bottom","border_left","border_right"),c&&CORE.DOM.CacheArray[e].children[0]&&CORE.DOM.CacheArray[e].removeChild(CORE.DOM.CacheArray[e].children[0]),CORE.DOM.CacheArray[e].children[0]&&CORE.DOM.CacheArray[e].removeChild(CORE.DOM.CacheArray[e].children[0]),
b=CORE.DOM.CacheArray[e].getAttribute("name"))a=b.match(CORE.REGEX.numbers).join(""),b=b.match(CORE.REGEX.letters).join(""),CORE.Cells.Used[CORE.CurrentSheet][a]&&CORE.Cells.Used[CORE.CurrentSheet][a][a+b]?CORE.DOM.CacheArray[e].style.background=CORE.Cells.Used[CORE.CurrentSheet][a][a+b].BackgroundColor:CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns[a]?CORE.DOM.CacheArray[e].style.background=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Columns[a].BackgroundColor:CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows[b]&&
(CORE.DOM.CacheArray[e].style.background=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected.Rows[b].BackgroundColor)};
CORE.Selector.prototype.selectCellByKeyPress=function(){var a=this.parentSelectedCell.Letter,b=this.parentSelectedCell.Number;0>=CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX+a?(a=a+CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX+CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX,1<=CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX&&--CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX,CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX+=1,CORE.Sheets[CORE.CurrentSheet].updateWidth("default"),
CORE.Sheets[CORE.CurrentSheet].updateMenu()):CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX+a>=CORE.Sheets[CORE.CurrentSheet].Settings.x+1?(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX+=1,a=CORE.Sheets[CORE.CurrentSheet].Settings.x+CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX,--CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX,CORE.Sheets[CORE.CurrentSheet].updateWidth("default"),CORE.Sheets[CORE.CurrentSheet].updateMenu()):a+=CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX+
CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX;0>=CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+b?(b=1,CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+=1,1<=CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY&&--CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY,CORE.Sheets[CORE.CurrentSheet].updateHeight("up",1),CORE.Sheets[CORE.CurrentSheet].updateMenu()):CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+b>=CORE.Sheets[CORE.CurrentSheet].Settings.y+1?(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY+=
1,b=CORE.Sheets[CORE.CurrentSheet].Settings.y+CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY,--CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY,CORE.Sheets[CORE.CurrentSheet].updateHeight("up",1),CORE.Sheets[CORE.CurrentSheet].updateMenu()):b+=CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY;CORE.Sheets[CORE.CurrentSheet].Input.Keyboard.Shift?this.getSelectionByKeyPress(a,b):(this.select={Letter:a,Number:b},this.Selected.First={Letter:a,
Number:b},this.Selected.Last={Letter:a,Number:b},this.getSelection())};CORE.Selector.prototype.getSelectionByKeyPress=function(a,b){this.Selected.First=this.Select;this.Selected.Last={Letter:a,Number:b};this.getSelection()};
CORE.Selector.prototype.menuSelection=function(){var a=0,b=0;0<=["verticalPositive","horizontalPositive","horizontalNegativePositive"].indexOf(this.selectionMode)?(a=this.Selected.Last.Letter-1,b=this.Selected.Last.Number-1):0<=["verticalNegative","horizontalNegative","horizontalNegativeNegative"].indexOf(this.selectionMode)&&(a=this.Selected.First.Letter-1,b=this.Selected.First.Number-1);for(var a=a-CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX,b=b-CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY,
c=0;c<CORE.DOM.HorizontalMenu.children.length;++c)CORE.DOM.HorizontalMenu.children[c].classList.remove("cell_dark"),CORE.DOM.HorizontalMenu.children[c].classList.remove("cell_bright");for(c=0;c<CORE.DOM.VerticalMenu.children.length;++c)CORE.DOM.VerticalMenu.children[c].classList.remove("cell_dark"),CORE.DOM.VerticalMenu.children[c].classList.remove("cell_bright");this.allSelected||(this.MenuSelection.Horizontal=a,this.MenuSelection.Vertical=b,CORE.DOM.HorizontalMenu.children[a]&&(CORE.DOM.HorizontalMenu.children[a].classList.add("cell_bright"),
CORE.DOM.HorizontalMenu.children[a].classList.remove("cell_dark")),CORE.DOM.VerticalMenu.children[b]&&(CORE.DOM.VerticalMenu.children[b].classList.add("cell_bright"),CORE.DOM.VerticalMenu.children[b].classList.remove("cell_dark")))};
CORE.Selector.prototype.getSelection=function(){this.deleteCellHoverEffect();if(this.allSelected)this.allCellHoverEffect(),CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit||CORE.Sheets[CORE.CurrentSheet].cleanEditSelection(),this.menuSelection();else{this.masterSelected.Current&&null!==this.masterSelected.Current&&(this.masterSelect(this.masterSelected.Current),"string"===typeof this.masterSelected.Current?(this.Selected.First={Letter:CORE.$.alphaToNumber(this.masterSelected.Current),Number:CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY},
this.Selected.Last={Letter:CORE.$.alphaToNumber(this.masterSelected.Current),Number:CORE.Sheets[CORE.CurrentSheet].Settings.y+(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY+1)}):"number"===typeof this.masterSelected.Current&&(this.Selected.First={Letter:CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX,Number:this.masterSelected.Current},this.Selected.Last={Letter:CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX+(CORE.Sheets[CORE.CurrentSheet].Settings.x+1),Number:this.masterSelected.Current}));
var a=this.Selected.First,b=this.Selected.Last;this.Selected.First.Letter=a.Letter;this.Selected.First.Number=a.Number||1;this.Selected.Last.Letter=b.Letter;this.Selected.Last.Number=b.Number||1;var a=CORE.$.alphaToNumber(this.Selected.Last.Letter)-CORE.$.alphaToNumber(this.Selected.First.Letter),b=this.Selected.Last.Number+this.Selected.First.Number,c=null,d=this.Selected.First.Letter,e=this.Selected.First.Number,f=this.Selected.Last.Letter,g=this.Selected.Last.Number;this.SelectedCells=[];a=f-d;
b=g>e?g-e+e:e;if(0===a&&0<=b)for(this.selectionMode="verticalPositive",this.Selected.First.Number>this.Selected.Last.Number&&(c=this.Selected.First.Number,this.Selected.First.Number=this.Selected.Last.Number,this.Selected.Last.Number=c,this.selectionMode="verticalNegative"),c=0;c<b;++c)c+1>=e?this.SelectedCells.push({letter:d,number:c+1}):c+1>=g&&this.SelectedCells.push({letter:d,number:c+1});else if(0<a)if(e<=g)for(this.selectionMode="horizontalPositive",f=0;f<=a;++f)for(c=0;c<b;++c)c+1>=e&&this.SelectedCells.push({letter:d+
f,number:c+1});else{this.Selected.First.Number=this.Selected.Last.Number;this.Selected.Last.Number=e;e=g;for(f=0;f<=a;++f)for(c=0;c<b;++c)c+1>=e&&this.SelectedCells.push({letter:d+f,number:c+1});this.selectionMode="horizontalNegative"}else if(0>a)for(this.Selected.First.Letter>this.Selected.Last.Letter&&(c=this.Selected.First.Letter,this.Selected.First.Letter=this.Selected.Last.Letter,this.Selected.Last.Letter=c,this.selectionMode="horizontalNegativePositive"),this.Selected.First.Number>this.Selected.Last.Number&&
(e=g,c=this.Selected.First.Number,this.Selected.First.Number=this.Selected.Last.Number,this.Selected.Last.Number=c,this.selectionMode="horizontalNegativeNegative"),a=~a+1,d=f,g=e,f=0;f<=a;++f)for(c=0;c<b;++c)c+1>=g&&this.SelectedCells.push({letter:d+f,number:c+1});this.addCellHoverEffect();this.menuSelection();CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit||CORE.Sheets[CORE.CurrentSheet].cleanEditSelection()}};
CORE.Selector.prototype.selectCell=function(a,b){this.deleteCellHoverEffect();this.Select={Letter:a,Number:b};this.Selected.First.Letter=a;this.Selected.First.Number=b;this.Selected.Last.Letter=a;this.Selected.Last.Number=b;this.SelectedCells=[{letter:a,number:b}];this.getSelection()};
CORE.Selector.prototype.moveSelection=function(a,b){var c=this.Selected.First.Letter,d=this.Selected.First.Number,e=c,f=d;switch(a){case "right":e=c+b;break;case "left":e=c-b;break;case "up":f=d-b;break;case "down":f=d+b}0>=e&&(e=1,this.parentSelectedCell.Letter=e);0>=f&&(f=1,this.parentSelectedCell.Number=f);CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledX=CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY=0;"down"===a&&CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+d>=CORE.Sheets[CORE.CurrentSheet].Settings.y+
CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY-1&&(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY+=1,--CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY);"up"===a&&(CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+d<=CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY+1&&--CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY,CORE.Sheets[CORE.CurrentSheet].Settings.keyScrolledY+=1);CORE.Sheets[CORE.CurrentSheet].updateHeight("up",1);CORE.Sheets[CORE.CurrentSheet].generateMenu();this.selectCell(e,
f)};CORE.Selector.prototype.select=function(a){this.Selected.First=a.first;this.Selected.Last=a.last;this.getSelection()};
CORE.Selector.prototype.getOuterSelection=function(a,b){var c=a||this.Selected.First,d=b||this.Selected.Last,e={top:[],bottom:[],left:[],right:[]};if(a&&b){this.SelectedCells=[];for(var f=a.Letter;f<b.Letter;++f)for(var g=a.Number;g<b.Number;++g)this.SelectedCells.push({letter:f,number:g})}for(f=0;f<this.SelectedCells.length;++f)c.Letter===this.SelectedCells[f].letter&&e.left.push(this.SelectedCells[f]),d.Letter===this.SelectedCells[f].letter&&e.right.push(this.SelectedCells[f]),c.Number===this.SelectedCells[f].number&&
e.top.push(this.SelectedCells[f]),d.Number===this.SelectedCells[f].number&&e.bottom.push(this.SelectedCells[f]);return e};
CORE.Selector.prototype.drawOuterBorder=function(){for(var a=this.getOuterSelection(),b="",b="",c=0;c<a.top.length;++c)b=CORE.$.numberToAlpha(a.top[c].letter),b=CORE.Cells.Used[CORE.CurrentSheet][b][b+a.top[c].number],b.Border.used=!0,b.Border.top=!0;for(c=0;c<a.bottom.length;++c)b=CORE.$.numberToAlpha(a.bottom[c].letter),b=CORE.Cells.Used[CORE.CurrentSheet][b][b+a.bottom[c].number],b.Border.used=!0,b.Border.bottom=!0;for(c=0;c<a.left.length;++c)b=CORE.$.numberToAlpha(a.left[c].letter),b=CORE.Cells.Used[CORE.CurrentSheet][b][b+
a.left[c].number],b.Border.used=!0,b.Border.left=!0;for(c=0;c<a.right.length;++c)b=CORE.$.numberToAlpha(a.right[c].letter),b=CORE.Cells.Used[CORE.CurrentSheet][b][b+a.right[c].number],b.Border.used=!0,b.Border.right=!0;CORE.Sheets[CORE.CurrentSheet].updateWidth("default")};
CORE.Selector.prototype.drawSelectionOuterBorder=function(a){a=a||this.getOuterSelection();for(var b=0,c=0;c<a.top.length;++c)b=CORE.$.getCell(a.top[c]),0<=b&&CORE.DOM.CacheArray[b].classList.add("border_top");for(c=0;c<a.bottom.length;++c)b=CORE.$.getCell(a.bottom[c]),0<=b&&CORE.DOM.CacheArray[b].classList.add("border_bottom");for(c=0;c<a.left.length;++c)b=CORE.$.getCell(a.left[c]),0<=b&&CORE.DOM.CacheArray[b].classList.add("border_left");for(c=0;c<a.right.length;++c)b=CORE.$.getCell(a.right[c]),
0<=b&&CORE.DOM.CacheArray[b].classList.add("border_right")};CORE.Selector.prototype.jump=function(a,b){switch(a){case "up":CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY-=0<=b?b-1:0;break;case "down":CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY+=b-1}CORE.Sheets[CORE.CurrentSheet].updateHeight(a,b);CORE.Sheets[CORE.CurrentSheet].updateMenu();this.getSelection();this.selectCellByKeyPress();CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY=!0};
CORE.Selector.prototype.deleteCellSelection=function(){this.allSelected?this.deleteAllCellsContent():void 0!==this.masterSelected.Current&&null!==this.masterSelected.Current&&this.deleteMasterSelectionContent();for(var a=this.SelectedCells,b=0;b<a.length;++b){var c=CORE.$.numberToAlpha(a[b].letter),d=a[b].number;CORE.Cells.Used[CORE.CurrentSheet][c]&&CORE.Cells.Used[CORE.CurrentSheet][c][c+d]&&(CORE.Cells.Used[CORE.CurrentSheet][c][c+d].Content="")}CORE.Sheets[CORE.CurrentSheet].updateWidth("default")};
CORE.Selector.prototype.deleteAllCellsContent=function(){var a=CORE.Cells.Used[CORE.CurrentSheet],b;for(b in a)for(var c in a[b])a[b][c].Content=""};CORE.Selector.prototype.deleteMasterSelectionContent=function(){var a=this.masterSelected.Current,b=CORE.Cells.Used[CORE.CurrentSheet];if(b[a])for(var c in b[a])b[a][c].Content=""};
CORE.Selector.prototype.allSelectOuterBorder=function(){var a=this.getOuterSelection({Letter:CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX||1,Number:CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY||1},{Letter:CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX+CORE.Sheets[CORE.CurrentSheet].Settings.x+1,Number:CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY+CORE.Sheets[CORE.CurrentSheet].Settings.y+1});this.drawSelectionOuterBorder(a)};
CORE.Selector.prototype.masterSelect=function(a){switch(typeof a){case "string":this.masterSelected.Columns[a]||(this.masterSelected.Columns[a]=new CORE.Sheets[CORE.CurrentSheet].Cell);break;case "number":this.masterSelected.Rows[a]||(this.masterSelected.Rows[a]=new CORE.Sheets[CORE.CurrentSheet].Cell)}this.masterSelected.Current=a};CORE.Selector.prototype.inheritMasterStyling=function(a,b,c){for(var d in CORE.Cells.Used[CORE.CurrentSheet][a])CORE.Cells.Used[CORE.CurrentSheet][a][d][c]=b[c]};
CORE.Commander=function(){this.Stack={redoCommands:[],undoCommands:[]};this.Settings={maxRedo:250,maxUndo:250,redoPosition:0,undoPosition:0}};CORE.Commander.prototype=CORE.Commander;CORE.Commander.prototype.constructor=CORE.Commander;CORE.Commander.prototype.redo=function(){console.log("Redo!")};CORE.Commander.prototype.undo=function(){console.log("Undo!");this.Stack.undoCommands.length+1>=this.Settings.maxUndo&&this.Stack.undoCommand.shift();this.executeUndo(this.lastUndoCommand())};
CORE.Commander.prototype.pushRedoCommand=function(a){this.Stack.redoCommands.push(a)};CORE.Commander.prototype.shiftRedoCommand=function(){return this.Stack.redoCommands.pop()};CORE.Commander.prototype.pushUndoCommand=function(a){this.Stack.undoCommands.push(a)};CORE.Commander.prototype.lastUndoCommand=function(){return this.Stack.undoCommands.pop()};CORE.Commander.prototype.executeUndo=function(a){if(a)switch(a.caller){case "Selector":switch(a.action){case "select":this.reverseSelection(a.data)}}};
CORE.Commander.prototype.Command=function(a,b,c){this.caller=a;this.action=b;this.data=c};CORE.Commander.prototype.Command=CORE.Commander.Command;CORE.Commander.prototype.reverseSelection=function(a){CORE.Sheets[CORE.CurrentSheet].Selector.select(a)};CORE.Commander.prototype.sheetAction=function(a,b,c){console.log(a,b,c)};CORE.Styler=function(){};CORE.Styler.prototype=CORE.Styler;CORE.Styler.prototype.constructor=CORE.Styler;
CORE.Styler.prototype.getSlaveSheets=function(){var a=[],b;for(b in CORE.Sheets)CORE.Sheets.hasOwnProperty(b)&&(CORE.Sheets[b].isMasterSheet()||a.push(b));return a};
CORE.Styler.prototype.inheritSheetStyling=function(a,b){for(var c=typeof b,d=CORE.Sheets[CORE.CurrentSheet].Selector.SelectedCells,e=this.getSlaveSheets(),f=0;f<e.length;++f){CORE.Cells.Used[e[f]]||(CORE.Cells.Used[e[f]]={});for(var g=0;g<d.length;++g){var h=CORE.$.numberToAlpha(d[g].letter),k=d[g].number;CORE.$.registerCell({letter:h,number:k,sheet:e[f]});CORE.Cells.Used[e[f]][h][h+k][a]="boolean"===c?CORE.Cells.Used[e[f]][h][h+k][a]?!1:!0:b}}};
CORE.Styler.prototype.inheritSheetMasterStyling=function(a,b,c){for(var d=typeof b,e=this.getSlaveSheets(),f=isNaN(parseInt(c))?"Columns":"Rows",g=0;g<e.length;++g){var h=CORE.Sheets[e[g]].Selector.masterSelected;h[f][c]||(h[f][c]=new CORE.Grid.Cell);h[f][c][a]="boolean"===d?h[f][c][a]?!1:!0:b}};
CORE.Styler.prototype.inheritCellValue=function(a){for(var b=this.getSlaveSheets(),c=a.letter,d=a.number,e=0;e<b.length;++e)CORE.Cells.Used[b[e]]||(CORE.Cells.Used[b[e]]={}),CORE.$.registerCell({letter:c,number:d,sheet:b[e]}),CORE.Cells.Used[b[e]][c][c+d][a.type]=a.value};CORE.Styler.prototype.inheritInjection=function(a,b){for(var c=CORE.Sheets[CORE.CurrentSheet],d=this.getSlaveSheets(),e=0;e<d.length;++e)CORE.Injector[b](d[e],c.Selector.Selected.First)};
CORE.Styler.prototype.inheritResize=function(a,b){var c=isNaN(parseInt(a))?"alphabetical":"numeric",d=this.getSlaveSheets();if("alphabetical"===c)for(var e=0;e<d.length;++e)CORE.Sheets[d[e]].customCellSizes[c][a]||(CORE.Sheets[d[e]].customCellSizes[c][a]={Width:0,Height:0}),CORE.Sheets[d[e]].customCellSizes[c][a].Width=b,CORE.Sheets[d[e]].Settings.cellResizedX=b,CORE.Sheets[d[e]].Input.lastAction.scrollY=!1,CORE.Sheets[d[e]].Input.Mouse.CellResize=!0;else for(e=0;e<d.length;++e)CORE.Sheets[d[e]].customCellSizes[c][a]||
(CORE.Sheets[d[e]].customCellSizes[c][a]={Width:0,Height:0}),CORE.Sheets[d[e]].customCellSizes[c][a].Height=b,CORE.Sheets[d[e]].Settings.cellResizedY=b,CORE.Sheets[d[e]].customCellSizes.array.push(parseInt(a)),CORE.Sheets[d[e]].Input.Mouse.CellResize=!0};
CORE.Styler.prototype.inheritPasteCells=function(a,b){for(var c=this.getSlaveSheets(),d=a.Letter,e=a.Number,f=0;f<c.length;++f)for(var g=0,h=0,k=d,m=e,l=0;l<b.length;++l){b[l].number!==m&&h++;b[l].letter!==k&&(g++,h=0);k=b[l].letter;m=b[l].number;b[l].letter=b[l].letter+d-b[l].letter+g;b[l].number=b[l].number+e-b[l].number+h;var n=CORE.$.numberToAlpha(b[l].letter),p=b[l].number;CORE.$.registerCell({letter:n,number:p,sheet:c[f]});CORE.Cells.Used[c[f]][n][n+p].Content=b[l].value}};
CORE.Styler.prototype.backgroundStyle=function(a){var b=CORE.Sheets[CORE.CurrentSheet].Selector,c=b.masterSelected,d=c.Current;c.Current&&null!==c.Current&&(CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&this.inheritSheetMasterStyling("BackgroundColor",a,c.Current),c=c.Columns[c.Current]||c.Rows[c.Current])&&(c.BackgroundColor=a);CORE.$.validateCells();CORE.Cells.Used[CORE.CurrentSheet][d]&&b.inheritMasterStyling(d,c,"BackgroundColor");for(c=0;c<b.SelectedCells.length;++c)d=CORE.$.numberToAlpha(b.SelectedCells[c].letter),
CORE.Cells.Used[CORE.CurrentSheet][d][d+b.SelectedCells[c].number].BackgroundColor=a,d=CORE.$.getCell({letter:b.SelectedCells[c].letter,number:b.SelectedCells[c].number}),0<=d&&(CORE.DOM.Output.children[d].style.background=a);CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&this.inheritSheetStyling("BackgroundColor",a);b.getSelection()};
CORE.Styler.prototype.fontColor=function(a){var b=0,c=CORE.Sheets[CORE.CurrentSheet].Selector,d=c.masterSelected,b=d.Current;c.masterSelected.Current&&null!==c.masterSelected.Current&&(CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&this.inheritSheetMasterStyling("Color",a,d.Current),d=d.Columns[d.Current]||d.Rows[d.Current])&&(d.Color=a);CORE.$.validateCells();CORE.Cells.Used[CORE.CurrentSheet][b]&&c.inheritMasterStyling(b,d,"Color");for(d=0;d<c.SelectedCells.length;++d)b=CORE.$.numberToAlpha(c.SelectedCells[d].letter),
CORE.Cells.Used[CORE.CurrentSheet][b][b+c.SelectedCells[d].number].Color=a,b=CORE.$.getCell({letter:c.SelectedCells[d].letter,number:c.SelectedCells[d].number}),0<=b&&(CORE.DOM.Output.children[b].style.color=a);CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&this.inheritSheetStyling("Color",a);c.getSelection()};
CORE.Styler.prototype.fontBold=function(){var a=0,b=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected,a=b.Current,c=CORE.Sheets[CORE.CurrentSheet].Selector;c.masterSelected.Current&&null!==c.masterSelected.Current&&(CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&this.inheritSheetMasterStyling("FontBold",!0,b.Current),b=b.Columns[b.Current]||b.Rows[b.Current])&&(b.FontBold=b.FontBold?!1:!0);CORE.$.validateCells();CORE.Cells.Used[CORE.CurrentSheet][a]&&c.inheritMasterStyling(a,b,"FontBold");for(b=
0;b<c.SelectedCells.length;++b){var a=CORE.$.numberToAlpha(c.SelectedCells[b].letter),d=a+c.SelectedCells[b].number;CORE.Cells.Used[CORE.CurrentSheet][a][d].FontBold?(CORE.Cells.Used[CORE.CurrentSheet][a][d].FontBold=!1,a=CORE.$.getCell({letter:c.SelectedCells[b].letter,number:c.SelectedCells[b].number}),0<=a&&(CORE.DOM.Output.children[a].style.fontWeight="normal")):(CORE.Cells.Used[CORE.CurrentSheet][a][d].FontBold=!0,a=CORE.$.getCell({letter:c.SelectedCells[b].letter,number:c.SelectedCells[b].number}),
0<=a&&(CORE.DOM.Output.children[a].style.fontWeight="bold"))}CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&this.inheritSheetStyling("FontBold",!0);c.getSelection()};
CORE.Styler.prototype.fontItalic=function(){var a=0,b=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected,a=b.Current,c=CORE.Sheets[CORE.CurrentSheet].Selector;c.masterSelected.Current&&null!==c.masterSelected.Current&&(CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&this.inheritSheetMasterStyling("FontItalic",!0,b.Current),b=b.Columns[b.Current]||b.Rows[b.Current])&&(b.FontItalic=b.FontItalic?!1:!0);CORE.$.validateCells();CORE.Cells.Used[CORE.CurrentSheet][a]&&c.inheritMasterStyling(a,b,"FontItalic");
for(b=0;b<c.SelectedCells.length;++b){var a=CORE.$.numberToAlpha(c.SelectedCells[b].letter),d=a+c.SelectedCells[b].number;CORE.Cells.Used[CORE.CurrentSheet][a][d].FontItalic?(CORE.Cells.Used[CORE.CurrentSheet][a][d].FontItalic=!1,a=CORE.$.getCell({letter:c.SelectedCells[b].letter,number:c.SelectedCells[b].number}),0<=a&&(CORE.DOM.Output.children[a].style.fontStyle="normal")):(CORE.Cells.Used[CORE.CurrentSheet][a][d].FontItalic=!0,a=CORE.$.getCell({letter:c.SelectedCells[b].letter,number:c.SelectedCells[b].number}),
0<=a&&(CORE.DOM.Output.children[a].style.fontStyle="italic"))}CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&this.inheritSheetStyling("FontItalic",!0);c.getSelection()};
CORE.Styler.prototype.fontUnderline=function(){var a=0,b=CORE.Sheets[CORE.CurrentSheet].Selector.masterSelected,a=b.Current,c=CORE.Sheets[CORE.CurrentSheet].Selector;c.masterSelected.Current&&null!==c.masterSelected.Current&&(CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&this.inheritSheetMasterStyling("FontUnderlined",!0,b.Current),b=b.Columns[b.Current]||b.Rows[b.Current])&&(b.FontUnderlined=b.FontUnderlined?!1:!0);CORE.$.validateCells();CORE.Cells.Used[CORE.CurrentSheet][a]&&c.inheritMasterStyling(a,
b,"FontUnderlined");for(b=0;b<c.SelectedCells.length;++b){var a=CORE.$.numberToAlpha(c.SelectedCells[b].letter),d=a+c.SelectedCells[b].number;CORE.Cells.Used[CORE.CurrentSheet][a][d].FontUnderlined?(CORE.Cells.Used[CORE.CurrentSheet][a][d].FontUnderlined=!1,a=CORE.$.getCell({letter:c.SelectedCells[b].letter,number:c.SelectedCells[b].number}),0<=a&&(CORE.DOM.Output.children[a].style.textDecoration="none")):(CORE.Cells.Used[CORE.CurrentSheet][a][d].FontUnderlined=!0,a=CORE.$.getCell({letter:c.SelectedCells[b].letter,
number:c.SelectedCells[b].number}),0<=a&&(CORE.DOM.Output.children[a].style.textDecoration="underline"))}CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&this.inheritSheetStyling("FontUnderlined",!0);c.getSelection()};CORE.$={};
CORE.$.init=function(){CORE.$.isMobile();CORE.$.detectBrowser();CORE.$.prepareEvents();CORE.Settings.Scroll.OriginalVertical=CORE.Settings.Scroll.Vertical=CORE.$.calculateScrollAmount();CORE.Settings.Mobile&&FastClick.attach(document.body);CORE.Connector=new CORE.Connector;CORE.File=new CORE.File;CORE.Awakener=new CORE.Awakener;CORE.Sheets=new CORE.Sheets;CORE.Extender=new CORE.Extender;CORE.Sheets.addSheet();CORE.Sheets.changeSheet(CORE.CurrentSheet);CORE.$.initCurrentCellButton();CORE.Event.init();
CORE.Sheets[CORE.CurrentSheet].Selector=new CORE.Selector;CORE.Sheets[CORE.CurrentSheet].Commander=new CORE.Commander;CORE.Injector=new CORE.Injector;CORE.Styler=new CORE.Styler;CORE.Sheets[CORE.CurrentSheet].Selector.selectCell(1,1);CORE.Connector.getURL()&&CORE.Connector.connect();CORE.Speedy=new CORE.Speedy;CORE.ClipBoard=new CORE.ClipBoard;CORE.newCommand=function(){return new CORE.Sheets[CORE.CurrentSheet].Commander.Command}};
CORE.$.isMobile=function(){/iPhone|iPad|iPod|Android|Mobile/i.test(navigator.userAgent)&&(CORE.Settings.Mobile=!0)};CORE.$.prepareEvents=function(){CORE.Events={mouseDown:CORE.Settings.Mobile?"touchstart":"mousedown",mouseUp:CORE.Settings.Mobile?"touchend":"mouseup",mouseMove:CORE.Settings.Mobile?"touchmove":"mousemove",mouseOut:CORE.Settings.Mobile?"touchleave":"mouseout"}};
CORE.$.initCurrentCellButton=function(){CORE.DOM.CurrentCell.addEventListener("click",function(){CORE.Sheets[CORE.CurrentSheet].Selector.allSelected=!0;CORE.Sheets[CORE.CurrentSheet].Selector.getSelection()})};CORE.$.detectBrowser=function(){CORE.Settings.isFirefox="undefined"!==typeof InstallTrigger?!0:!1;CORE.Settings.isSafari=0<Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")?!0:!1;CORE.Settings.isChrome=window.chrome?!0:!1;CORE.Settings.isIE=document.documentMode?!0:!1};
CORE.$.calculateScrollAmount=function(){return Math.floor(Math.pow(CORE.Settings.Height,Math.floor(Math.log(CORE.Settings.Height)/Math.log(CORE.Settings.Height)))/100/4)};CORE.$.numberToAlpha=function(a){var b=0,c=0,b=65+(a-1)%26,b=65>=b?String.fromCharCode(65):String.fromCharCode(b),c=parseInt((a-1)/26);return 0<c?CORE.$.numberToAlpha(c)+b:b};
CORE.$.alphaToNumber=function(a){if(isNaN(a)){var b=0,c=a.charCodeAt(0),c=65>=c?1:c%65+1,b=parseInt(26*(c-1)),b=b+26;return(a=a.substr(1,a.length))?CORE.$.alphaToNumber(a)+b:c}};CORE.$.getCell=function(a){var b=a.letter;a=CORE.Sheets[CORE.CurrentSheet].Settings.y*(b-1)+a.number-1-CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY-CORE.Sheets[CORE.CurrentSheet].Settings.y*CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX;if(CORE.$.isInView(b,a)&&CORE.DOM.Output.children[a])return a};
CORE.$.isInView=function(a,b){return b<a*CORE.Sheets[CORE.CurrentSheet].Settings.y-CORE.Sheets[CORE.CurrentSheet].Settings.y-CORE.Sheets[CORE.CurrentSheet].Settings.y*CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX||b>=a*CORE.Sheets[CORE.CurrentSheet].Settings.y-CORE.Sheets[CORE.CurrentSheet].Settings.y*CORE.Sheets[CORE.CurrentSheet].Settings.scrolledX?!1:!0};
CORE.$.validCell=function(){if(CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter&&0<=CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number){var a=CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter,b=CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number;if(a&&0<b&&(CORE.$.registerCell({letter:a,number:b}),CORE.Cells.Used[CORE.CurrentSheet][a][a+b]))return!0}return!1};
CORE.$.validateCells=function(a){a=a||CORE.CurrentSheet;for(var b=0;b<CORE.Sheets[a].Selector.SelectedCells.length;++b){var c=CORE.$.numberToAlpha(CORE.Sheets[a].Selector.SelectedCells[b].letter);CORE.$.registerCell({letter:c,number:CORE.Sheets[a].Selector.SelectedCells[b].number,sheet:a})}};
CORE.$.registerCell=function(a){var b=a.sheet||CORE.CurrentSheet,c=a.letter;a=c+a.number;CORE.Cells.Used[b][c]?CORE.Cells.Used[b][c][a]||(CORE.Cells.Used[b][c][a]=new CORE.Sheets[b].Cell):(CORE.Cells.Used[b][c]={},CORE.Cells.Used[b][c][a]=new CORE.Sheets[b].Cell)};CORE.$.looseSelection=function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()};
CORE.$.selectText=function(a){var b=a.textContent.length,c;document.selection?(c=document.selection.createRange(),c.moveStart("character",b),c.select()):(c=window.getSelection(),c.collapse(a.firstChild,b))};CORE.$.isJSON=function(a){try{JSON.parse(a)}catch(b){return!1}return!0};CORE.$.isSafeInteger=function(a){return 9E15<=a&&a>=window.Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER-1:a};CORE.$.getVariables=function(a){return a.match(CORE.REGEX.variable)};
CORE.$.hexToRgba=function(a){a=a.replace("#","");a=a.match(new RegExp("(.{"+a.length/3+"})","g"));for(var b=0;b<a.length;b++)a[b]=parseInt(1==a[b].length?a[b]+a[b]:a[b],16);"undefined"!=typeof opacity&&a.push(opacity);return"rgb("+a.join(",")+")"};
CORE.$.replaceNumbers=function(a,b){var c=a.length,d=/[a-zA-Z_!@#$%^&*()+\-=\[\]{};':"\\|,.<>\s]+/g.exec(a),e,f;e=d.index;f=/[0-9]+/g.exec(a);var g,h;g=f.index;h=c-f[0].length;f=c-g;d=d[0];c=Array(c+1).join(" ");c=c.substring(0,g)+b+c.substring(h-1);return c=c.substring(0,e)+d+c.substring(f-1)};
CORE.$.createSheet=function(a,b){CORE.Cells.Used[CORE.CurrentSheet]||(CORE.Cells.Used[CORE.CurrentSheet]={});CORE.Sheets[a]=new CORE.Grid;CORE.Sheets[a].Selector=new CORE.Selector;CORE.Sheets[a].Commander=new CORE.Commander;b&&(CORE.Sheets[a].Settings.master=!0)};
CORE.$.killSheet=function(a){CORE.Sheets[a].Settings.master&&0<CORE.MasterSheetCount&&CORE.MasterSheetCount--;for(var b in CORE.Cells.Used[a]){for(var c in CORE.Cells.Used[a][b])CORE.Cells.Used[a][b][c]=null,delete CORE.Cells.Used[a][b][c];CORE.Cells.Used[a][b]=null;delete CORE.Cells.Used[a][b]}CORE.ClipBoard.copiedCells[a]=[];CORE.ClipBoard.copiedCells[a]=null;delete CORE.ClipBoard.copiedCells[a];CORE.Sheets[a].Selector.SelectedCells=[];CORE.Sheets[a].Selector.SelectedCells=null;delete CORE.Sheets[a].Selector.SelectedCells;
CORE.Sheets[a].Selector=null;delete CORE.Sheets[a].Selector;CORE.Sheets[a]=null;delete CORE.Sheets[a];CORE.Connector.connected&&CORE.Connector.action("deleteSheet",{sheet:a})};
CORE.Grid.prototype.getEditSelection=function(a){if(a&&void 0!==a){var b=CORE.$.numberToAlpha(a.letter),c=a.number,d=0,e=null;CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit=!0;d=CORE.$.getCell(a);0<=d&&(e=CORE.DOM.Output.children[d]);e&&e.classList.remove("cell_edit");e&&(e.classList.add("cell_edit"),CORE.Cells.Used[CORE.CurrentSheet][b]?CORE.Cells.Used[CORE.CurrentSheet][b][b+c]||CORE.registerCell(b+c):CORE.registerCell(b+c),CORE.Cells.Used[CORE.CurrentSheet][b]&&CORE.Cells.Used[CORE.CurrentSheet][b][b+
c]&&(CORE.validCell(b+c)||CORE.registerCellVariable(b+c),CORE.Cells.Used[CORE.CurrentSheet][b][b+c].Formula&&CORE.Cells.Used[CORE.CurrentSheet][b][b+c].Formula.length&&CORE.Cells.Used[CORE.CurrentSheet][b][b+c].Formula!==CORE.Cells.Used[CORE.CurrentSheet][b][b+c].Content&&(e.innerHTML=CORE.Cells.Used[CORE.CurrentSheet][b][b+c].Formula,this.goToEndOfCellText())));CORE.Sheets[CORE.CurrentSheet].Selector.Edit=b+c;CORE.DOM.CurrentCell.innerHTML=CORE.Sheets[CORE.CurrentSheet].Selector.Edit;CORE.Sheets[CORE.CurrentSheet].Selector.deleteCellHoverEffect();
CORE.Sheets[CORE.CurrentSheet].Selector.menuSelection(CORE.$.alphaToNumber(b)-1,c-1)}};
CORE.Grid.prototype.cleanEditSelection=function(){if(CORE.Sheets[CORE.CurrentSheet].Selector.Edit){var a=CORE.Sheets[CORE.CurrentSheet].Selector.Edit.match(CORE.REGEX.numbers).join(""),b=~~CORE.Sheets[CORE.CurrentSheet].Selector.Edit.match(CORE.REGEX.letters).join(""),c=this.Settings.y*(CORE.$.alphaToNumber(a)-1)+b-1-this.Settings.scrolledY-this.Settings.y*this.Settings.scrolledX;CORE.DOM.Output.children[c]&&CORE.DOM.Output.children[c].classList.remove("cell_edit");CORE.DOM.Output.children[c+CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY]&&
CORE.DOM.Output.children[c+CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY].classList.remove("cell_edit");CORE.DOM.Output.children[c-CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY]&&CORE.DOM.Output.children[c-CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY].classList.remove("cell_edit");CORE.Cells.Used[CORE.CurrentSheet][a]&&CORE.Cells.Used[CORE.CurrentSheet][a][a+b]&&CORE.Cells.Used[CORE.CurrentSheet][a][a+b].Formula&&CORE.Cells.Used[CORE.CurrentSheet][a][a+b].Formula.length&&CORE.Cells.Used[CORE.CurrentSheet][a][a+
b].Formula!==CORE.Cells.Used[CORE.CurrentSheet][a][a+b].Content&&(c=CORE.$.getCell({letter:a,number:b}),0<=c&&(CORE.DOM.Output.children[c].innerHTML=CORE.Cells.Used[CORE.CurrentSheet][a][a+b].Content))}CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit=!1};
CORE.Grid.prototype.goToEndOfCellText=function(){if(CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter&&CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number){var a=CORE.$.getCell({letter:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Letter,number:CORE.Sheets[CORE.CurrentSheet].Selector.Selected.First.Number});0<=a&&CORE.$.selectText(CORE.DOM.Output.children[a])}};CORE.File=function(){};CORE.File.prototype=CORE.File;
CORE.File.prototype.getData=function(){var a='"Cells":'+JSON.stringify(CORE.Cells)+",",b='"CellSizes":'+JSON.stringify(CORE.Grid.customCellSizes)+",",c='"CellStack":'+JSON.stringify(ENGEL.STACK.VAR)+",",d='"CoreSettings":'+JSON.stringify(CORE.Settings)+",",e='"GridSettings":'+JSON.stringify(CORE.Grid.Settings);return"{"+a+b+c+d+e+"}"};
CORE.File.prototype["import"]=function(a){a=JSON.parse(JSON.parse(a));CORE.Grid.customCellSizes=a.CellSizes;CORE.Grid.Settings=a.GridSettings;CORE.Cells=a.Cells;ENGEL.STACK.VAR=a.CellStack;CORE.Event.resize()};CORE.File.prototype["export"]=function(){var a=document.createElement("a");document.body.appendChild(a);a.style.display="none";var b=JSON.stringify(this.getData()),b=new Blob([b],{type:"application/json"}),b=window.URL.createObjectURL(b);a.href=b;a.download="Untitled.nvc";a.click();window.URL.revokeObjectURL(b)};
CORE.File.prototype.exportImage=function(){AJAX.POST(this.getData(),"server/base64ToImage.php",function(a){var b=new Image;b.src="server/uploads/"+a;CORE.DOM.FileOutput.innerHTML="";CORE.DOM.FileOutput.appendChild(b);CORE_UI.MODAL.FileImageOutput.$.style.display="block"})};CORE.Awakener=function(){this.currentlyRunning={}};CORE.Awakener.prototype=CORE.Awakener;CORE.Awakener.prototype.evalLive=function(){for(var a in CORE.Cells.Live)CORE.Cells.Live[a].Url&&(this.asleep(a),this.awake(a))};
CORE.Awakener.prototype.awake=function(a){var b=this;CORE.Cells.Live[a]&&!CORE.Cells.Live[a].Active&&(CORE.Cells.Live[a].Active=!0,this.currentlyRunning[a]=setInterval(function(){CORE.Sheets[CORE.CurrentSheet].Input.Mouse.Edit||b.get(a)},CORE.Cells.Live[a].RefreshTime))};CORE.Awakener.prototype.asleep=function(a){this.currentlyRunning[a]&&(window.clearInterval(this.currentlyRunning[a]),CORE.Cells.Live[a].Active=!1)};
CORE.Awakener.prototype.get=function(a){var b=this;AJAX.GET(CORE.Cells.Live[a].Url,function(c){CORE.Cells.Live[a].Data=c;b.processData(a)})};CORE.Awakener.prototype.processData=function(a){var b=a.match(CORE.REGEX.numbers).join("");CORE.Cells.Live[a].Data&&CORE.Cells.Live[a].Data.length&&(CORE.Cells.Used[b][a]||CORE.registerCell(a),CORE.$.isJSON(CORE.Cells.Live[a].Data)&&(CORE.Cells.Live[a].Data=JSON.parse(CORE.Cells.Live[a].Data)),CORE.eval())};
CORE.Awakener.prototype.reset=function(){for(var a in CORE.Cells.Live)CORE.Cells.Live[a].Active=!1};CORE.ClipBoard=function(){this.copiedText=null;this.copiedCells={}};CORE.ClipBoard.prototype=CORE.ClipBoard;CORE.ClipBoard.prototype.constructor=CORE.ClipBoard;CORE.ClipBoard.prototype.copyTextToClipBoard=function(a){this.copiedText=a};CORE.ClipBoard.prototype.readTextFromClipBoard=function(){return this.copiedText};
CORE.ClipBoard.prototype.copyCellsToClipBoard=function(){this.copiedCells[CORE.CurrentSheet]||(this.copiedCells[CORE.CurrentSheet]={});this.copiedCells[CORE.CurrentSheet]=[];this.copiedCells[CORE.CurrentSheet]=CORE.Sheets[CORE.CurrentSheet].Selector.SelectedCells;this.validateCellContent()};
CORE.ClipBoard.prototype.validateCellContent=function(){for(var a=this.copiedCells[CORE.CurrentSheet],b=null,c=0;c<a.length;++c){var b=CORE.$.numberToAlpha(a[c].letter),d=a[c].number;CORE.Cells.Used[CORE.CurrentSheet][b]&&CORE.Cells.Used[CORE.CurrentSheet][b][b+d]&&(b=CORE.Cells.Used[CORE.CurrentSheet][b][b+d].Content,void 0!==b&&null!==b&&(a[c].value=b))}};
CORE.ClipBoard.prototype.pasteCellsIntoSheet=function(a){var b=this.copiedCells[CORE.CurrentSheet];if(b&&b.length&&a){var b=b.slice(0),c=a.Letter,d=a.Number,e=c,f=d,g=0,h=0;CORE.Sheets[CORE.CurrentSheet].isMasterSheet()&&CORE.Styler.inheritPasteCells(a,b);for(a=0;a<b.length;++a){b[a].number!==f&&h++;b[a].letter!==e&&(g++,h=0);e=b[a].letter;f=b[a].number;b[a].letter=b[a].letter+c-b[a].letter+g;b[a].number=b[a].number+d-b[a].number+h;var k=CORE.$.numberToAlpha(b[a].letter),m=b[a].number;CORE.$.registerCell({letter:k,
number:m});CORE.Cells.Used[CORE.CurrentSheet][k][k+m].Content=b[a].value}CORE.Sheets[CORE.CurrentSheet].updateWidth("default")}};CORE.Connector=function(){this.socket=null;this.url="http://134.255.219.177";this.port=3E3;this.state=null;this.connected=!1;this.connectionStreak=0;this.states={0:"Stable",1:"Danger",2:"Lost"};this.room=null};CORE.Connector.prototype=CORE.Connector;CORE.Connector.prototype.constructor=CORE.Connector;
CORE.Connector.prototype.connect=function(){if(!window.io)throw Error("NovaeCalc requires socket.io!");this.socket=io.connect(this.url+":"+this.port);this.initListeners();this.createRoom()};CORE.Connector.prototype.initListeners=function(){var a=this;this.socket.on("connected",function(){a.state=0;a.connectionStreak=(new Date).getTime();a.connected=!0});this.socket.on("message",function(b){a.message(b)})};
CORE.Connector.prototype.message=function(a){if(a&&a.type)switch(a.type){case "room":this.room=a.values;this.socket.emit("getroom",{room:this.room});break;case "roomdata":this.room&&a.data&&this.processServerCells(a.data.sheets);break;case "global":switch(a.action){case "cellchange":this.processServerCell(a.data);break;case "scrolling":this.processServerScrolling(a.data);break;case "newsheet":this.processNewSheet(a.data);break;case "deletesheet":this.processSheetDeletion(a.data)}}};
CORE.Connector.prototype.connectionTime=function(){return Math.floor((new Date).getTime()/1E3-this.connectionStreak/1E3)};
CORE.Connector.prototype.createRoom=function(){var a=this,b=this.getURL(),c="";b&&b.length&&(b=b.slice(1,b.length),this.socket.emit("createroom",{name:b,sheet:CORE.CurrentSheet},function(b){b?prompt("Please save the following master access key for this room!",b):(c=prompt("Please enter the room password: "),a.socket.emit("securitypassword",{password:c,room:a.room,sheet:CORE.CurrentSheet},function(b){a.processServerCells(b);a.processNewSheet({sheet:CORE.CurrentSheet})}))}))};
CORE.Connector.prototype.loginModal=function(){window.mui&&CORE_UI.Modal("<h3 class='modalTitle'>Initialize Connection</h3>","<button class='mui-btn mui-btn-primary mui-btn-lg alertButton alertOk' name='ok'>Ok</button><button class='mui-btn mui-btn-primary mui-btn-lg alertButton alertAbort' name='abort'>Abort</button>",function(a){console.log(a)})};CORE.Connector.prototype.getURL=function(){if(window.location.search)return window.location.search};
CORE.Connector.prototype.action=function(a,b){switch(a){case "updateCell":this.updateCell(b);break;case "scrolling":this.updateScrolling(b);break;case "changeSheet":this.changeSheet(b);break;case "deleteSheet":this.deleteSheet(b)}};CORE.Connector.prototype.changeSheet=function(a){a&&a.sheet&&"string"===typeof a.sheet&&this.socket.emit("changesheet",{sheet:a.sheet})};CORE.Connector.prototype.deleteSheet=function(a){a&&a.sheet&&"string"===typeof a.sheet&&this.socket.emit("deletesheet",{sheet:a.sheet})};
CORE.Connector.prototype.updateScrolling=function(a){a.direction&&a.amount&&0<=a.position&&"string"===typeof a.direction&&"number"===typeof a.amount&&"number"===typeof a.position&&this.socket.emit("scrolling",{direction:a.direction,amount:a.amount,position:a.position})};CORE.Connector.prototype.updateCell=function(a){a.cell&&a.value&&a.value.length&&(a.letter=a.cell.match(CORE.REGEX.numbers).join(""),a.sheet=CORE.CurrentSheet,this.socket.emit("updatecell",a))};
CORE.Connector.prototype.processServerCells=function(a){var b=[],c;for(c in a){b.push(c);CORE.Sheets[c]||(CORE.Sheets[c]=new CORE.Grid,CORE.Sheets.addSheet(c));for(var d in a[c].cells)for(var e in a[c].cells[d])CORE.Cells.Used[c]||(CORE.Cells.Used[c]={}),CORE.Cells.Used[c][d]||(CORE.Cells.Used[c][d]={}),CORE.Cells.Used[c][d][e]||(CORE.Cells.Used[c][d][e]=new CORE.Grid.Cell),"="===a[c].cells[d][e][0]?CORE.Cells.Used[c][d][e].Formula=a[c].cells[d][e]:CORE.Cells.Used[c][d][e].Content=a[c].cells[d][e]}if(b.length)for(c in CORE.Sheets)!CORE.Sheets.hasOwnProperty(c)||
0<=b.indexOf(c)||CORE.Sheets.killSwitchSheet(c);CORE.Sheets[CORE.CurrentSheet].updateWidth("default");CORE.eval()};
CORE.Connector.prototype.processServerCell=function(a){CORE.Cells.Used[a.sheet][a.letter]||(CORE.Cells.Used[a.sheet][a.letter]={});CORE.Cells.Used[a.sheet][a.letter][a.cell]||(CORE.Cells.Used[a.sheet][a.letter][a.cell]=new CORE.Grid.Cell);"="===a.value[0]?";"===a.value[a.value.length-1]&&(CORE.Cells.Used[a.sheet][a.letter][a.cell].Formula=a.value):CORE.Cells.Used[a.sheet][a.letter][a.cell].Content=a.value;CORE.Sheets[CORE.CurrentSheet].updateWidth("default");CORE.eval()};
CORE.Connector.prototype.processServerScrolling=function(a){a&&a.sheet===CORE.CurrentSheet&&a.direction&&"string"===typeof a.direction&&0<=["up","down","left","right"].indexOf(a.direction)&&a.amount&&"number"===typeof a.amount&&a.position&&"number"===typeof a.position&&0<=["up","down"].indexOf(a.direction)&&("up"===a.direction?0>=a.position-1-CORE.Settings.Scroll.Vertical?(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY=0,CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=0,CORE.Sheets[CORE.CurrentSheet].updateHeight("default",
CORE.Settings.Scroll.Vertical),CORE.Event.animateMouseUpMaximum()):(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY=a.position,CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=a.amount,CORE.Sheets[CORE.CurrentSheet].updateHeight(a.direction,a.amount),CORE.Event.animateMouseUp()):"down"===a.direction&&(CORE.Sheets[CORE.CurrentSheet].Settings.scrolledY=a.position,CORE.Sheets[CORE.CurrentSheet].Settings.lastScrollY=a.amount,CORE.Sheets[CORE.CurrentSheet].updateHeight(a.direction,a.amount),CORE.Event.animateMouseDown()),
CORE.Sheets[CORE.CurrentSheet].Input.lastAction.scrollY=!0,CORE.Sheets[CORE.CurrentSheet].updateMenu(),CORE.Sheets[CORE.CurrentSheet].Selector.getSelection())};CORE.Connector.prototype.processNewSheet=function(a){a.sheet&&"string"===typeof a.sheet&&(CORE.Sheets[a.sheet]||(CORE.Sheets[a.sheet]=new CORE.Grid,CORE.Sheets.addSheet(a.sheet)),CORE.Sheets.changeSheet(a.sheet))};CORE.Connector.prototype.processSheetDeletion=function(a){a.sheet&&"string"===typeof a.sheet&&CORE.Sheets[a.sheet]&&CORE.Sheets.killSwitchSheet(a.sheet)};
var root=this,ENGEL=ENGEL||{};ENGEL.prototype=ENGEL;ENGEL.prototype.constructor=ENGEL;ENGEL.prototype.init=function(){this.Lexer=new ENGEL.LEXER;this.Parser=new ENGEL.PARSER;this.Evaluator=new ENGEL.EVAL};ENGEL.prototype.interpret=function(a){this.lexed=this.Lexer.lex(a);this.ast=this.Parser.parse(this.lexed);this.Evaluator.evaluate(this.ast);return ENGEL.STACK};root.ENGEL=ENGEL;ENGEL.STACK={VAR:{}};ENGEL.STACK.prototype=ENGEL.STACK;ENGEL.STACK.prototype.dump=function(){this.VAR={}};
ENGEL.STACK.prototype.get=function(a){if(this.VAR[a])return this.VAR[a]};ENGEL.STACK.prototype.getValue=function(a){if(this.VAR[a])return this.VAR[a].value.value};ENGEL.STACK.prototype.update=function(a,b){if(this.VAR[a])return this.VAR[a].value=b};ENGEL.STACK.prototype.createVariable=function(a){if(!this.VAR[a])return this.VAR[a]={name:"undefined",type:"var",value:{value:null,type:null,raw:null}},this.VAR[a]};
ENGEL.LEXER=function(){this.Tokens=[];this.KeyWords=[{name:"LX_IF",rx:/^(wenn|if)(?![a-zA-Z0-9_])/},{name:"LX_ELSE",rx:/^(sonst|else)(?![a-zA-Z0-9_])/},{name:"LX_LPAR",rx:/^[\\(]()+/},{name:"LX_RPAR",rx:/^[\\)]()+/},{name:"LX_LBRAC",rx:/^[\\{]+/},{name:"LX_RBRAC",rx:/^[\\}]+/},{name:"LX_LHBRAC",rx:/^\[.*?/},{name:"LX_RHBRAC",rx:/^\].*?/},{name:"LX_SEMIC",rx:/^[;]+/},{name:"LX_EQ",rx:/^==/},{name:"LX_NEQ",rx:/^!=/},{name:"LX_AND",rx:/^(&&)/},{name:"LX_OR",rx:/^([\\|\\|])+/},{name:"LX_GRE",rx:/^>=/},
{name:"LX_LWE",rx:/^<=/},{name:"LX_GR",rx:/^>/},{name:"LX_LW",rx:/^</},{name:"LX_ASSIGN",rx:/^=/},{name:"LX_COMMA",rx:/^,/},{name:"LX_JSON",rx:/^(JSON)/},{name:"LX_JSON_CALL",rx:/^->/},{name:"LX_MATH",rx:/^(roundTo|asin|sin|acos|cos|atan|atan2|tan|sqrt|cbrt|exp|random|min|max|round|floor|ceil)/},{name:"LX_CONNECT",rx:/^(verbinden|connect)/},{name:"LX_VAR",rx:/^[a-zA-Z_][a-zA-Z0-9_]*/},{name:"LX_NUMBER",rx:/^[-]?[0-9]+(\.\d+[0-9]*)?/},{name:"LX_STRING",rx:/^"(\\\\"|[^"])(.*?)"|'"'(\\\\'|[^'])*'"/},
{name:"LX_PLUS",rx:/^\+(?!\+)/},{name:"LX_MINUS",rx:/^\-(?!-)/},{name:"LX_MULT",rx:/^[*]+/},{name:"LX_DIV",rx:/^[/]+/},{name:"LX_POW",rx:/^[^]/}];this.reservedKeyWords=["INFINITY","NAN"];this.isVariable=/^[A-Z]+[0-9]+$/;this.blank=/^[ \t\v\f]+/;this.notBlank=/^\S+/;this.lineBreak=/^[\r\n]+/;this.isBlank=function(a){return a.match(this.blank)};this.isNotBlank=function(a){return a.match(this.notBlank)};this.isLineBreak=function(a){return a.match(this.lineBreak)};this.isValidVariable=function(a){return a.match(this.isVariable)}};
ENGEL.LEXER.prototype=ENGEL.LEXER;
ENGEL.LEXER.prototype.lex=function(a){for(this.Tokens=[];a;){for(var b=this.isLineBreak(a)||this.isBlank(a),c=0;!b&&c<this.KeyWords.length;++c)if(b=a.match(this.KeyWords[c].rx)){0<=["LX_UPLUS","LX_UMINUS"].indexOf(this.KeyWords[c].name)&&(b[0]=b[0].slice(0,-1));"LX_VAR"===this.KeyWords[c].name&&(b[0]=b[0].toUpperCase(),0<=this.reservedKeyWords.indexOf(b[0])&&console.log(b[0]+" is a reserved word and shall not be used!"),this.isValidVariable(b[0])||console.log(b[0]+" is a invalid variable name!"));
if("LX_NUMBER"===this.KeyWords[c].name&&"LX_NUMBER"===this.Tokens[this.Tokens.length-1].type&&0>parseFloat(b[0])){this.Tokens.push({type:"LX_MINUS",value:"-"});b[0]=b[0].slice(0,1);break}if(0<=["LX_MINUS","LX_PLUS"].indexOf(this.KeyWords[c].name)&&-1>=["LX_NUMBER","LX_VAR","LX_STRING","LX_RPAR"].indexOf(this.Tokens[this.Tokens.length-1].type)&&"("===a.substring(b[0].length)[0]){switch(this.KeyWords[c].name){case "LX_PLUS":this.Tokens.push({type:"LX_UPLUS",value:b[0].trim()});break;case "LX_MINUS":this.Tokens.push({type:"LX_UMINUS",
value:b[0].trim()})}b[0]=b[0].slice(0,1);break}this.Tokens.push({type:this.KeyWords[c].name,value:b[0].trim()})}if(!b){console.log(a[0]+" is not defined!");break}if(b||this.notBlank(a))a=a.substring(b[0].length);else break}return this.Tokens};ENGEL.PARSER=function(){this.currentBlock=this.block=null;this.ReservedFunctions=["LX_CONNECT","LX_JSON"];this.MathFunctions=["LX_MATH"]};ENGEL.PARSER.prototype=ENGEL;ENGEL.PARSER.prototype.parse=function(a){return this.createAST(a)};
ENGEL.PARSER.prototype.createAST=function(a){if(!a[0])return a;this.block=a;if("LX_VAR"===this.block[0].type)return this.variable()};ENGEL.PARSER.prototype.variable=function(){var a=this.block,b={AssignmentExpression:{id:{type:"Identifier",name:a[0].value},init:null,kind:"var"}},c=b.AssignmentExpression;"LX_VAR"===a[0].type&&a.shift();if(a[0]&&"LX_ASSIGN"===a[0].type)return this.shift(),c.init=this.expressionStatement(),b};
ENGEL.PARSER.prototype.expressionStatement=function(){var a=this.block,b=null;a[a.length-1]&&"LX_SEMIC"!==a[a.length-1].type&&this.addSemicolon();this.shift();b=this.ruleExpression();return{ExpressionStatement:b}};
ENGEL.PARSER.prototype.functionAssignment=function(){var a=this.block,b={callee:{Identifier:a[0].value},arguments:[]};this.shift();"LX_CONNECT"===this.currentBlock.type?"LX_LPAR"===a[0].type&&(b.arguments=this.readFunctionArguments()):0<=this.MathFunctions.indexOf(this.currentBlock.type)?"LX_LPAR"===a[0].type&&(b.arguments=this.readFunctionArguments()):"LX_JSON"===this.currentBlock.type&&("LX_LPAR"===a[0].type&&(b.arguments=this.readFunctionArguments()),b.append=[],this.shift(),this.shift(),b.append=
this.readFunctionArguments());this.shift();this.shift();return{CallExpression:b}};
ENGEL.PARSER.prototype.readFunctionArguments=function(){var a=this.block,b=[],c=[],d=[],e=0;if(this.emptyArguments())return[];for(;a[0];){0<=this.ReservedFunctions.concat(this.MathFunctions).indexOf(a[0].type)&&(b.push(this.functionAssignment()),this.shift(),a.shift());"LX_LPAR"===a[0].type?e++:"LX_RPAR"===a[0].type&&e--;if(0<=["LX_COMMA","LX_JSON_CALL"].indexOf(a[0].type))b.push(c),c=[];else if(0<=["LX_RPAR","LX_SEMIC"].indexOf(a[0].type)&&0>=e){b.push(c);break}-1>=["LX_COMMA","LX_JSON_CALL"].indexOf(a[0].type)&&
c.push(a[0]);a.shift()}for(c=0;c<b.length;++c)b[c].CallExpression?d.push(b[c]):(this.block=b[c],this.shift(),this.addSemicolon(),d.push(this.ruleExpression()));this.block=a;return d};ENGEL.PARSER.prototype.emptyArguments=function(){return this.block[0]&&this.block[1]&&"LX_LPAR"===this.block[0].type&&(this.shift(),"LX_RPAR"===this.block[0].type)?(this.shift(),this.shift(),!0):!1};ENGEL.PARSER.prototype.addSemicolon=function(){this.block.push({type:"LX_SEMIC",value:";"})};
ENGEL.PARSER.prototype.ruleExpression=function(){var a;for(this.accept("LX_MINUS")||(this.accept("LX_PLUS")?this.shift():a=this.ruleTerm());this.accept("LX_PLUS LX_MINUS LX_EQ LX_NEQ LX_GR LX_GRE LX_LW LX_LWE LX_AND LX_OR".split(" "));)a={operator:this.currentBlock.type,left:a},this.shift(),a.right=this.ruleTerm();return a};
ENGEL.PARSER.prototype.ruleTerm=function(){var a;for(a=this.ruleFactor();this.accept("LX_POW LX_MULT LX_DIV LX_EQ LX_NEQ LX_GR LX_GRE LX_LW LX_LWE LX_AND LX_OR".split(" "));)a={operator:this.currentBlock.type,left:a},this.shift(),a.right=this.ruleFactor();return a};
ENGEL.PARSER.prototype.ruleFactor=function(){var a,b;this.accept(["LX_NUMBER","LX_VAR","LX_STRING"])?(b=0<=["LX_NUMBER","LX_STRING"].indexOf(this.currentBlock.type)?"Literal":"Identifier",a={},a[b]={value:ENGEL.TypeMaster(this.currentBlock.value).value},this.shift()):this.accept("LX_LPAR")?(this.shift(),a=this.ruleExpression(),this.expect("LX_RPAR")&&this.shift()):this.accept(["LX_UPLUS","LX_UMINUS"])?(a={operator:this.currentBlock.type},this.shift(),a.init=this.ruleFactor()):this.accept(this.ReservedFunctions.concat(this.MathFunctions))&&
(this.block.unshift(this.currentBlock),a=this.functionAssignment());return a};ENGEL.PARSER.prototype.accept=function(a){if(!this.block[0])return!1;if("string"===typeof a){if(this.currentBlock&&this.currentBlock.type===a)return!0}else for(var b=0;b<a.length;++b)if(this.currentBlock&&this.currentBlock.type===a[b])return!0;return!1};ENGEL.PARSER.prototype.shift=function(){this.currentBlock=this.block.shift()};ENGEL.PARSER.prototype.expect=function(a){return this.accept(a)?!0:!1};
ENGEL.EVAL=function(){var a=this;this.functionName=this.switcher=null;this.Functions={LX_POW:function(b){return Math.pow(a.interpretExpression(b.left),a.interpretExpression(b.right))},LX_UPLUS:function(b){return+a.interpretExpression(b)},LX_UMINUS:function(b){return-a.interpretExpression(b)},LX_PLUS:function(b){return a[a.switcher](b.left,a.functionName)+a[a.switcher](b.right,a.functionName)},LX_MINUS:function(b){return a[a.switcher](b.left,a.functionName)-a[a.switcher](b.right,a.functionName)},LX_MULT:function(b){return a[a.switcher](b.left,
a.functionName)*a[a.switcher](b.right,a.functionName)},LX_DIV:function(b){return a[a.switcher](b.left,a.functionName)/a[a.switcher](b.right,a.functionName)},LX_EQ:function(b){return a[a.switcher](b.left,a.functionName)==a[a.switcher](b.right,a.functionName)},LX_NEQ:function(b){return a[a.switcher](b.left,a.functionName)!=a[a.switcher](b.right,a.functionName)},LX_LW:function(b){return a[a.switcher](b.left,a.functionName)<a[a.switcher](b.right,a.functionName)},LX_GR:function(b){return a[a.switcher](b.left,
a.functionName)>a[a.switcher](b.right,a.functionName)},LX_LWE:function(b){return a[a.switcher](b.left,a.functionName)<=a[a.switcher](b.right,a.functionName)},LX_GRE:function(b){return a[a.switcher](b.left,a.functionName)>=a[a.switcher](b.right,a.functionName)},LX_AND:function(b){var c=a[a.switcher](b.left,a.functionName);return c?a[a.switcher](b.right,a.functionName):c},LX_OR:function(b){var c=a[a.switcher](b.left,a.functionName);return c?c:a[a.switcher](b.right,a.functionName)}};this.preDefFunc=
{display:["log","print"],math:"asin sin acos cos atan atan2 tan sqrt cbrt exp random min max round floor ceil roundTo".split(" "),json:["JSON","json"],ajax:["CONNECT","connect"]}};ENGEL.EVAL.prototype=ENGEL;
ENGEL.EVAL.prototype.evalVariable=function(a){var b=a.kind;"Identifier"===a.id.type&&(ENGEL.STACK.VAR[a.id.name]={name:a.id.name,type:b,value:{value:null,type:null,raw:null}});a.init&&(a.init.ExpressionStatement?(b=this.interpretExpression(a.init.ExpressionStatement),ENGEL.STACK.update(a.id.name,{raw:b,value:this.TypeMaster(b).value,type:typeof b})):a.init.CallExpression&&this.evalExpression(a.init.CallExpression,a.id.name))};ENGEL.EVAL.prototype.evaluate=function(a){a.AssignmentExpression&&this.evalVariable(a.AssignmentExpression)};
ENGEL.EVAL.prototype.interpretExpression=function(a){if(!isNaN(a))return a;if(a){this.switcher="interpretExpression";if(a.init)return this.Functions[a.operator](a.init);if(a.CallExpression)return this.evalExpression(a.CallExpression);if(a.Identifier)return(a=ENGEL.STACK.getValue(a.Identifier.value))||""===a||0===a?a:0;if(a.Literal)return a.Literal.value;if(this.Functions[a.operator])return this.Functions[a.operator](a)}};
ENGEL.EVAL.prototype.evalExpression=function(a,b){var c=a.callee;if(0<=this.preDefFunc.ajax.indexOf(c.Identifier)){var d="",e=0,d=this.interpretExpression(a.arguments[0]),e=this.interpretExpression(a.arguments[1]);0>=e&&(console.info(b+": Invalid refresh time value, reset to 1000!"),e=1E3);CORE.Cells.Live[b]||CORE.registerLiveCell(b);CORE.Cells.Live[b]&&(CORE.Cells.Live[b].Url=d,CORE.Cells.Live[b].RefreshTime=e);CORE.Awakener.evalLive()}else if(0<=this.preDefFunc.json.indexOf(c.Identifier)){c=a.arguments[0].Identifier.value;
d=null;if(CORE.Cells.Live[c]){for(e=0;e<a.append.length;++e)a.append[e]=this.interpretExpression(a.append[e]);CORE.Cells.Live[c].Data&&(d=this.readJSONTree(CORE.Cells.Live[c].Data,a.append))}ENGEL.STACK.get(b)&&ENGEL.STACK.update(b,{raw:d,value:this.TypeMaster(d).value,type:typeof d})}else if(0<=this.preDefFunc.math.indexOf(c.Identifier)){for(var d=null,f=[],e=0;e<a.arguments.length;++e)a.arguments[e].CallExpression?f.push(this.evalExpression(a.arguments[e].CallExpression)):f.push(this.interpretExpression(a.arguments[e]));
window.Math[c.Identifier]&&(d=f&&f.length?Math[c.Identifier].apply(null,f):Math[c.Identifier].apply(null,null));b&&ENGEL.STACK.get(b)&&ENGEL.STACK.update(b,{raw:d,value:this.TypeMaster(d).value,type:typeof d});return d}};ENGEL.EVAL.prototype.readJSONTree=function(a,b){var c=null;if(void 0!==a[b[0]]||null!==a[b[0]])if(c=b.shift(),1<=b.length)return this.readJSONTree(a[c],b);return a[c]};
ENGEL.prototype.TypeMaster=function(a){var b={value:null,type:null,raw:a};b.value=a;if(!isNaN(a))b.value=parseFloat(a);else if("string"==typeof a||"object"==typeof a&&a.constructor===String)b.value=String(a.replace(/"/g,""));b.type=typeof b.value;return b};